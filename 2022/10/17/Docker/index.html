<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Docker精选 | pomeloisland</title><meta name="author" content="柚屿"><meta name="copyright" content="柚屿"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Docker精选  一、Docker入门1.Docker为什么会出现  2.Docker的历史 3.Docker的学习  Docker是基于Go语言开发的！开源项目 官网https:&#x2F;&#x2F;www.docker.com&#x2F; 官方文档https:&#x2F;&#x2F;docs.docker.com&#x2F;**Docker文档是超详细的** 仓库地址https:&#x2F;&#x2F;hub.docker.com&#x2F;  4.虚拟化技术和容器化技术对比4">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker精选">
<meta property="og:url" content="http://example.com/2022/10/17/Docker/index.html">
<meta property="og:site_name" content="pomeloisland">
<meta property="og:description" content="Docker精选  一、Docker入门1.Docker为什么会出现  2.Docker的历史 3.Docker的学习  Docker是基于Go语言开发的！开源项目 官网https:&#x2F;&#x2F;www.docker.com&#x2F; 官方文档https:&#x2F;&#x2F;docs.docker.com&#x2F;**Docker文档是超详细的** 仓库地址https:&#x2F;&#x2F;hub.docker.com&#x2F;  4.虚拟化技术和容器化技术对比4">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
<meta property="article:published_time" content="2022-10-17T01:10:34.794Z">
<meta property="article:modified_time" content="2022-10-17T03:50:35.792Z">
<meta property="article:author" content="柚屿">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2022/10/17/Docker/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Docker精选',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-10-17 11:50:35'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="pomeloisland" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">14</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">pomeloisland</a></span><div id="menus"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Docker精选</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-10-17T01:10:34.794Z" title="Created 2022-10-17 09:10:34">2022-10-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-10-17T03:50:35.792Z" title="Updated 2022-10-17 11:50:35">2022-10-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Docker精选"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Docker精选"><a href="#Docker精选" class="headerlink" title="Docker精选"></a>Docker精选</h1><!--mroe-->

<h1 id="一、Docker入门"><a href="#一、Docker入门" class="headerlink" title="一、Docker入门"></a>一、Docker入门</h1><h2 id="1-Docker为什么会出现"><a href="#1-Docker为什么会出现" class="headerlink" title="1.Docker为什么会出现"></a>1.Docker为什么会出现</h2><p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center.png" alt="在这里插入图片描述"></p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-16659693967663.png" alt="在这里插入图片描述"></p>
<h2 id="2-Docker的历史"><a href="#2-Docker的历史" class="headerlink" title="2.Docker的历史"></a>2.Docker的历史</h2><p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-16659694194126.png" alt="在这里插入图片描述"></p>
<h2 id="3-Docker的学习"><a href="#3-Docker的学习" class="headerlink" title="3.Docker的学习"></a>3.Docker的学习</h2><p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70.png" alt="在这里插入图片描述"></p>
<ul>
<li>Docker是基于Go语言开发的！开源项目</li>
<li>官网<a target="_blank" rel="noopener" href="https://www.docker.com/">https://www.docker.com/</a></li>
<li>官方文档<a target="_blank" rel="noopener" href="https://docs.docker.com/**Docker%E6%96%87%E6%A1%A3%E6%98%AF%E8%B6%85%E8%AF%A6%E7%BB%86%E7%9A%84">https://docs.docker.com/**Docker文档是超详细的</a>**</li>
<li>仓库地址<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></li>
</ul>
<h2 id="4-虚拟化技术和容器化技术对比"><a href="#4-虚拟化技术和容器化技术对比" class="headerlink" title="4.虚拟化技术和容器化技术对比"></a>4.虚拟化技术和容器化技术对比</h2><h3 id="4-1-虚拟化技术的缺点"><a href="#4-1-虚拟化技术的缺点" class="headerlink" title="4.1.虚拟化技术的缺点"></a>4.1.虚拟化技术的缺点</h3><ul>
<li>资源占用十分多</li>
<li>冗余步骤多</li>
<li>启动很慢</li>
</ul>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70-166596944685411.png" alt="在这里插入图片描述"></p>
<h3 id="4-2容器化技术"><a href="#4-2容器化技术" class="headerlink" title="4.2容器化技术"></a>4.2容器化技术</h3><p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70-166596946364914.png" alt="在这里插入图片描述"></p>
<ul>
<li>比较Docker和虚拟化技术的不同<ul>
<li>传统虚拟机，虚拟出一条硬件，运行一个完整的操作系统，然后在这个系统上安装和运行软件</li>
<li>容器内的应用直接运行在宿主机的内部，容器是没有自己的内核的，也没有虚拟硬件，所以轻便</li>
<li>每个容器间是相互隔离的，每个容器内都有一个属于自己的文件系统，互不影响</li>
</ul>
</li>
<li>应用更快速的交互和部署<ul>
<li>传统：一堆帮助文档，安装程序</li>
<li>Docker：打包镜像发布测试，一键运行</li>
</ul>
</li>
<li>更便捷的升级和扩缩容</li>
<li>更简的系统运维</li>
<li>更高效的计算资源利用</li>
</ul>
<h3 id="4-3DevOps"><a href="#4-3DevOps" class="headerlink" title="4.3DevOps"></a>4.3DevOps</h3><blockquote>
<p>DevOps（开发、运维）</p>
</blockquote>
<p><strong>应用更快速的交付和部署</strong></p>
<p>传统：一堆帮助文档，安装程序</p>
<p>Docekr：打包镜像发布测试，一键运行</p>
<p><strong>更便捷的升级和扩容</strong></p>
<p>使用了Docker之后，我们部署应用就像搭积木一样！</p>
<p>项目打包为一个镜像，扩展 服务A！服务B</p>
<p><strong>更简单的系统运维</strong></p>
<p>在容器化之后，我们的开发，测试环境都是高度一致的。</p>
<p><strong>更高效的计算资源利用</strong></p>
<p>Docker是内核级别的虚拟化，可以在一个物理机上运行很多的容器实例！服务器的性能可以被压榨到极致。</p>
<h2 id="5-名词解释"><a href="#5-名词解释" class="headerlink" title="5.名词解释"></a>5.名词解释</h2><ul>
<li>镜像（image）<ul>
<li>Docker镜像就好比是一个模板，可以通过这个模板来创建容器服务，tomcat镜像 &#x3D;&#x3D;&#x3D;&gt; run &#x3D;&#x3D;&#x3D;&gt; tomcat01容器，通过这个镜像可以创建多个容器（最终服务运行或者项目运行就是在容器中的）</li>
</ul>
</li>
<li>容器（container）<ul>
<li>Docker利用容器技术，独立运行一个或者一组应用，通过镜像来创建的</li>
<li>启动，停止，删除，基本命令！</li>
<li>就目前可以把这个容器理解为一个linux系统</li>
</ul>
</li>
<li>仓库（repository）<ul>
<li>存放镜像的地方</li>
<li>Dokcer Hub（默认是国外的）</li>
<li>阿里云…都有容器服务（配置镜像加速！）</li>
</ul>
</li>
</ul>
<h2 id="6-环境准备"><a href="#6-环境准备" class="headerlink" title="6.环境准备"></a>6.环境准备</h2><p>1、Linux内核要求3.0以上</p>
<p>2、CentOS 7</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zeak7sgj6i7hrb2g862z ~]<span class="comment"># uname -r</span></span><br><span class="line">3.10.0-514.26.2.el7.x86_64    <span class="comment"># 要求3.0以上</span></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z ~]<span class="comment"># cat /etc/os-release</span></span><br><span class="line">NAME=<span class="string">&quot;CentOS Linux&quot;</span></span><br><span class="line">VERSION=<span class="string">&quot;7 (Core)&quot;</span></span><br><span class="line">ID=<span class="string">&quot;centos&quot;</span></span><br><span class="line">ID_LIKE=<span class="string">&quot;rhel fedora&quot;</span></span><br><span class="line">VERSION_ID=<span class="string">&quot;7&quot;</span></span><br><span class="line">PRETTY_NAME=<span class="string">&quot;CentOS Linux 7 (Core)&quot;</span></span><br><span class="line">ANSI_COLOR=<span class="string">&quot;0;31&quot;</span></span><br><span class="line">CPE_NAME=<span class="string">&quot;cpe:/o:centos:centos:7&quot;</span></span><br><span class="line">HOME_URL=<span class="string">&quot;https://www.centos.org/&quot;</span></span><br><span class="line">BUG_REPORT_URL=<span class="string">&quot;https://bugs.centos.org/&quot;</span></span><br><span class="line">CENTOS_MANTISBT_PROJECT=<span class="string">&quot;CentOS-7&quot;</span></span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION=<span class="string">&quot;7&quot;</span></span><br><span class="line">REDHAT_SUPPORT_PRODUCT=<span class="string">&quot;centos&quot;</span></span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION=<span class="string">&quot;7&quot;</span></span><br></pre></td></tr></table></figure>

<p>3、阿里云镜像加速</p>
<p><img src="/2022/10/17/Docker/174493-20210828231950506-1441651533.png" alt="img"></p>
<p>4、登录阿里云服务器，找到容器镜像服务</p>
<p>5、设置Registry登陆密码</p>
<p><img src="/2022/10/17/Docker/174493-20210828232109747-1550650179.png" alt="img"></p>
<p>6、找到镜像加速器</p>
<p>7、配置使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、创建一个目录</span></span><br><span class="line">sudo <span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、编写配置文件</span></span><br><span class="line">sudo <span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://pi9dpp60.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<h2 id="7-安装Docker"><a href="#7-安装Docker" class="headerlink" title="7.安装Docker"></a>7.安装Docker</h2><p><strong>卸载旧版本</strong><br>较旧的Docker版本称为 docker 或 docker-engine 。如果已安装这些程序，请卸载它们以及相关的依赖项。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#3、 卸载旧版本</span></span><br><span class="line">yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure>

<p><strong>安装Docker Engine-Community</strong></p>
<p><strong>安装yum-utils</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#4、安装需要的安装包</span></span><br><span class="line">yum install -y yum-utils</span><br></pre></td></tr></table></figure>

<p><strong>使用Docker仓库进行安装</strong><br>在新主机上首次安装Docker Engine-Community之前，需要设置Docker仓库。之后，您可以从仓库安装和更新Docker。</p>
<p><strong>设置仓库（上面安装yum-utils无法使用才进行这一步）</strong><br>安装所需的软件包。yum-utils提供了yum-config-manager，并且device mapper存储驱动程序需要device-mapper-persistent-data和lvm2。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install -y yum-utils \</span><br><span class="line">  device-mapper-persistent-data \</span><br><span class="line">  lvm2</span><br></pre></td></tr></table></figure>

<p>使用一下命令来设置稳定的仓库。</p>
<p><strong>使用官方源地址（比较慢）</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#5、设置仓库地址  </span></span><br><span class="line"><span class="comment">#默认是从国外的，不推荐</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<p>可以选择国内的一些源地址：</p>
<p><strong>阿里云</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#5.1推荐使用国内的</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<p><strong>清华大学源</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<p><strong>安装 Docker Engine-Community</strong><br>安装最新版本的 Docker Engine-Community 和 containerd，或者转到下一步安装特地版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#6、更新yum软件包索引</span></span><br><span class="line">yum makecache fast (Centos8不需要fast)</span><br><span class="line"></span><br><span class="line"><span class="comment">#7、安装docker相关的 docker-ce 社区版 而ee是企业版</span></span><br><span class="line">yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line"><span class="comment">#8、设置docker开机启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br><span class="line"> </span><br><span class="line"><span class="comment">#9、启动docker </span></span><br><span class="line">systemctl start docker</span><br><span class="line"> </span><br><span class="line"><span class="comment">#10、使用docker version查看是否按照成功</span></span><br><span class="line">docker version</span><br><span class="line"> </span><br><span class="line"><span class="comment">#11、测试运行</span></span><br><span class="line">docker run hello-world</span><br><span class="line"> </span><br><span class="line"><span class="comment">#12、查看已经下载的镜像</span></span><br><span class="line">docker images</span><br><span class="line"></span><br><span class="line"><span class="comment">#13、清理镜像为&lt;none&gt;的镜像</span></span><br><span class="line">docker image prune -f</span><br><span class="line"> </span><br><span class="line"><span class="comment">#14、卸载docker</span></span><br><span class="line"> 14.1、卸载依赖</span><br><span class="line">       yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line"> 14.2、删除资源(/var/lib/docker 是docker的默认工作路径）</span><br><span class="line">       <span class="built_in">rm</span> -rf /var/lib/docker</span><br></pre></td></tr></table></figure>

<p>Docker 安装完默认未启动，并且已经创建好了 docker 用户组，但该用户组下没有用户。</p>
<p><strong>要特定安装版本的 Docker Engine-Community，请在存储库中列出可用版本，然后选择并安装：</strong><br>1、列出并排序 您存储库中可用的版本。此示例按版本号（从高到低）对结果进行排序。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum list docker-ce --showduplicates | <span class="built_in">sort</span> -r</span><br></pre></td></tr></table></figure>

<p>docker-ce.x86_64  3:18.09.1-3.el7           docker-ce-stable<br>docker-ce.x86_64  3:18.09.0-3.el7           docker-ce-stable<br>docker-ce.x86_64  18.06.1.ce-3.el7           docker-ce-stable<br>docker-ce.x86_64  18.06.0.ce-3.el7           docker-ce-stable</p>
<p>2、通过其完整的软件包名称安装特定版本，改软件包名称是软件包名称（docker-ce）加上版本字符串（第二列），从第一个冒号（：）一直到第一个连字符（-）分隔。例如： docker-ce-18.09.1。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io</span><br></pre></td></tr></table></figure>

<p>启动 Docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start docker</span><br></pre></td></tr></table></figure>

<p>通过运行 hello-world 映像来验证是否正确安装了 Docker Engine-Community。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run hello-world</span><br></pre></td></tr></table></figure>

<h2 id="8-底层原理"><a href="#8-底层原理" class="headerlink" title="8.底层原理"></a>8.底层原理</h2><ul>
<li>HelloWorld镜像</li>
</ul>
<p><img src="/2022/10/17/Docker/20200411132204381.png" alt="img"></p>
<p><img src="/2022/10/17/Docker/20200411132044294.png" alt="img"></p>
<p><img src="/2022/10/17/Docker/20200411132109992.png" alt="img"></p>
<ul>
<li><p>底层原理</p>
<p>Docker Engine是一个客户端-服务器应用程序，具有以下主要组件</p>
<ul>
<li>一个服务器，它是一种长期运行的程序，称为守护进程（docker 的命令）</li>
<li>一个 REST API，它指定程序可以用来与守护进程对话并指示它做什么接口。</li>
</ul>
</li>
</ul>
<p>Docker 是一个 <strong>Client Server <strong>的系统，Docker守护进程运行在主机上，然后通过Socket连接从客户端访问，守护进程从客户端接受命令并管理运行在主机上的容器。</strong>容器，是一个运行时环境就是我们所说的集装箱。</strong></p>
<p><img src="/2022/10/17/Docker/20200411132031597.png" alt="img"></p>
<ul>
<li>为什么 Docker 比 vm 快<ul>
<li>docker 有着比虚拟机更少的抽象层，由于 docker 不需要 Hypervisor 实现硬件资源虚拟化，运行在 docker 容器上的程序直接使用的都是实际物理机的硬件资源。因此在 CPU、内存利用率上 docker 将会在效率上有明显优势</li>
<li><strong>docker 利用的是宿主机的内核，而不需要 Guest OS</strong>。因此，当新建一个容器时，docker 不需要和虚拟机一样重新加载一个操作系统内核。从而避免引寻、加载操作系统内核是个比较费时费资源的过程，当新建一个虚拟机时，虚拟机软件需要加载 GuestOS，这个新建过程是分钟级别的，而 <strong>docker 由于直接利用宿主机的操作系统，则省略了这个过程，因此新建一个 docker 容器只需要几秒钟。</strong></li>
</ul>
</li>
</ul>
<p><img src="/2022/10/17/Docker/20200411132454634.png" alt="img"></p>
<h1 id="二、Docker-基本命令"><a href="#二、Docker-基本命令" class="headerlink" title="二、Docker 基本命令"></a>二、Docker 基本命令</h1><h3 id="1-Docker-的常用命令"><a href="#1-Docker-的常用命令" class="headerlink" title="1.Docker 的常用命令"></a>1.Docker 的常用命令</h3><p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70-166596960998431.png" alt="在这里插入图片描述"></p>
<p>帮助命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version  <span class="comment"># docker版本信息</span></span><br><span class="line">docker info     <span class="comment"># 系统级别的信息，包括镜像和容器的数量</span></span><br><span class="line">docker 命令 --<span class="built_in">help</span> </span><br></pre></td></tr></table></figure>

<ul>
<li>帮助文档<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/docker/">https://docs.docker.com/engine/reference/commandline/docker/</a></li>
</ul>
<h4 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h4><p><strong>docker images 查看所有本地主机上的镜像</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hello-world         latest              bf756fb1ae65        7 months ago        13.3kB</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 解释</span></span><br><span class="line">REPOSITORY      <span class="comment"># 镜像的仓库</span></span><br><span class="line">TAG             <span class="comment"># 镜像的标签，--lastest 表示最新版本</span></span><br><span class="line">IMAGE ID        <span class="comment"># 镜像的ID</span></span><br><span class="line">CREATED         <span class="comment"># 镜像的创建时间</span></span><br><span class="line">SIZE            <span class="comment"># 镜像的大小</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 可选项</span></span><br><span class="line">--all , -a      <span class="comment"># 列出所有镜像</span></span><br><span class="line">--quiet , -q    <span class="comment"># 只显示镜像的id</span></span><br><span class="line"></span><br><span class="line">docker images -a <span class="comment">#列出所有镜像详细信息</span></span><br><span class="line">docker images -aq <span class="comment">#列出所有镜像的id</span></span><br></pre></td></tr></table></figure>

<p><strong>dcoker serach 查找镜像</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">NAME                              DESCRIPTION                                     STARS               OFFICIAL         AUTOMATED</span><br><span class="line">mysql                             MySQL is a widely used, open-source relation…   9822                [OK]                </span><br><span class="line">mariadb                           MariaDB is a community-developed fork of MyS…   3586                [OK]                </span><br><span class="line">mysql/mysql-server                Optimized MySQL Server Docker images. Create…   719                                     [OK]</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 可选项</span></span><br><span class="line">--filter=STARS=3000     <span class="comment"># 搜素出来的镜像就是STARS大于3000的</span></span><br><span class="line"> </span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker search mysql --filter=STARS=3000</span></span><br><span class="line">NAME                DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">mysql               MySQL is a widely used, open-source relation…   9822                [OK]                </span><br><span class="line">mariadb             MariaDB is a community-developed fork of MyS…   3586   </span><br></pre></td></tr></table></figure>

<p><strong>docker pull 下拉镜像</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载镜像，docker pull 镜像名[:tag]</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker pull mysql</span></span><br><span class="line">Using default tag: latest           <span class="comment"># 如果不写tag，默认就是latest</span></span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">bf5952930446: Pull complete         <span class="comment"># 分层下载，dockerimages的核心，联合文件系统</span></span><br><span class="line">8254623a9871: Pull complete </span><br><span class="line">938e3e06dac4: Pull complete </span><br><span class="line">ea28ebf28884: Pull complete </span><br><span class="line">f3cef38785c2: Pull complete </span><br><span class="line">894f9792565a: Pull complete </span><br><span class="line">1d8a57523420: Pull complete </span><br><span class="line">6c676912929f: Pull complete </span><br><span class="line">ff39fdb566b4: Pull complete </span><br><span class="line">fff872988aba: Pull complete </span><br><span class="line">4d34e365ae68: Pull complete </span><br><span class="line">7886ee20621e: Pull complete </span><br><span class="line">Digest: sha256:c358e72e100ab493a0304bda35e6f239db2ec8c9bb836d8a427ac34307d074ed     <span class="comment"># 签名</span></span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> mysql:latest</span><br><span class="line">docker.io/library/mysql:latest      <span class="comment"># 真实地址</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 等价于</span></span><br><span class="line">docker pull mysql</span><br><span class="line">docker pull docker.io/library/mysql:latest</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 指定版本下载</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker pull mysql:5.7</span></span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line">bf5952930446: Already exists </span><br><span class="line">8254623a9871: Already exists </span><br><span class="line">938e3e06dac4: Already exists </span><br><span class="line">ea28ebf28884: Already exists </span><br><span class="line">f3cef38785c2: Already exists </span><br><span class="line">894f9792565a: Already exists </span><br><span class="line">1d8a57523420: Already exists </span><br><span class="line">5f09bf1d31c1: Pull complete </span><br><span class="line">1b6ff254abe7: Pull complete </span><br><span class="line">74310a0bf42d: Pull complete </span><br><span class="line">d398726627fd: Pull complete </span><br><span class="line">Digest: sha256:da58f943b94721d46e87d5de208dc07302a8b13e638cd1d24285d222376d6d84</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> mysql:5.7</span><br><span class="line">docker.io/library/mysql:5.7</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 查看本地镜像</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">mysql               5.7                 718a6da099d8        6 days ago          448MB</span><br><span class="line">mysql               latest              0d64f46acfd1        6 days ago          544MB</span><br><span class="line">hello-world         latest              bf756fb1ae65        7 months ago        13.3kB</span><br></pre></td></tr></table></figure>

<p><strong>docker rmi 删除镜像</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker rmi -f IMAGE ID                        # 删除指定镜像</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker rmi -f IMAGE ID1 IMAGE ID2 IMAGE ID3   # 删除多个镜像</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment">#  docker rmi -f $(docker images -aq)           # 删除所有镜像</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment">#  docker stop $(docker ps -a -q)               # 停止全部镜像</span></span><br></pre></td></tr></table></figure>

<h4 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h4><p><strong>说明：我们有了镜像才可以创建容器，Linux，下载一个 centos 镜像来测试学习</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos</span><br></pre></td></tr></table></figure>

<p><strong>新建容器并启动给</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#新建容器并启动</span></span><br><span class="line">docker run [可选参数] image</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 参数说明</span></span><br><span class="line">--name=“Name”   容器名字    tomcat01    tomcat02    用来区分容器</span><br><span class="line">-d      后台方式运行</span><br><span class="line">-it     使用交互方式运行，进入容器查看内容</span><br><span class="line">-p      指定容器的端口     -p 8080:8080</span><br><span class="line">    -p  ip:主机端口：容器端口</span><br><span class="line">    -p  主机端口：容器端口（常用）</span><br><span class="line">    -p  容器端口</span><br><span class="line">    容器端口</span><br><span class="line">-p      随机指定端口</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 测试，启动并进入容器</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker run -it centos /bin/bash</span></span><br><span class="line">[root@74e82b7980e7 /]<span class="comment"># ls   # 查看容器内的centos，基础版本，很多命令是不完善的</span></span><br><span class="line">bin  etc   lib    lost+found  mnt  proc  run   srv  tmp  var</span><br><span class="line">dev  home  lib64  media       opt  root  sbin  sys  usr</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 从容器中退回主机</span></span><br><span class="line">[root@77969f5dcbf9 /]<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ /]<span class="comment"># ls</span></span><br><span class="line">bin   dev  fanfan  lib    lost+found  mnt  proc  run   srv  tmp  var</span><br><span class="line">boot  etc  home    lib64  media       opt  root  sbin  sys  usr</span><br></pre></td></tr></table></figure>

<p><strong>列出所有的运行的容器</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker ps 命令</span></span><br><span class="line">        <span class="comment"># 列出当前正在运行的容器</span></span><br><span class="line">-a      <span class="comment"># 列出正在运行的容器包括历史容器</span></span><br><span class="line">-n=?    <span class="comment"># 显示最近创建的容器</span></span><br><span class="line">-q      <span class="comment"># 只显示当前容器的编号</span></span><br><span class="line"> </span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ /]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ /]<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">77969f5dcbf9        centos              <span class="string">&quot;/bin/bash&quot;</span>         5 minutes ago       Exited (0) 5 minutes ago                       xenodochial_bose</span><br><span class="line">74e82b7980e7        centos              <span class="string">&quot;/bin/bash&quot;</span>         16 minutes ago      Exited (0) 6 minutes ago                       silly_cori</span><br><span class="line">a57250395804        bf756fb1ae65        <span class="string">&quot;/hello&quot;</span>            7 hours ago         Exited (0) 7 hours ago                         elated_nash</span><br><span class="line">392d674f4f18        bf756fb1ae65        <span class="string">&quot;/hello&quot;</span>            8 hours ago         Exited (0) 8 hours ago                         distracted_mcnulty</span><br><span class="line">571d1bc0e8e8        bf756fb1ae65        <span class="string">&quot;/hello&quot;</span>            23 hours ago        Exited (0) 23 hours ago                        magical_burnell</span><br><span class="line"> </span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ /]<span class="comment"># docker ps -qa</span></span><br><span class="line">77969f5dcbf9</span><br><span class="line">74e82b7980e7</span><br><span class="line">a57250395804</span><br><span class="line">392d674f4f18</span><br><span class="line">571d1bc0e8e8</span><br></pre></td></tr></table></figure>

<p><strong>退出容器</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exit</span>            <span class="comment"># 直接退出容器并关闭</span></span><br><span class="line">Ctrl + P + Q    <span class="comment"># 容器不关闭退出</span></span><br></pre></td></tr></table></figure>

<p><strong>删除容器</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> -f 容器<span class="built_in">id</span>                 <span class="comment"># 删除指定容器</span></span><br><span class="line">docker <span class="built_in">rm</span> -f $(docker ps -aq)       <span class="comment"># 删除所有容器</span></span><br><span class="line">docker ps -a -q|xargs docker <span class="built_in">rm</span> -f  <span class="comment"># 删除所有的容器</span></span><br></pre></td></tr></table></figure>

<p><strong>启动和停止容器的操作</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start 容器<span class="built_in">id</span>           <span class="comment"># 启动容器</span></span><br><span class="line">docker restart 容器<span class="built_in">id</span>         <span class="comment"># 重启容器</span></span><br><span class="line">docker stop 容器<span class="built_in">id</span>            <span class="comment"># 停止当前正在运行的容器</span></span><br><span class="line">docker <span class="built_in">kill</span> 容器<span class="built_in">id</span>            <span class="comment"># 强制停止当前的容器</span></span><br></pre></td></tr></table></figure>

<h4 id="常用的其他命令"><a href="#常用的其他命令" class="headerlink" title="常用的其他命令"></a>常用的其他命令</h4><p><strong>后台启动容器</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 命令 docker run -d 镜像名</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ /]<span class="comment"># docker run -d centos</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 问题 docker ps， 发现centos停止了</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 常见的坑， docker 容器使用后台运行， 就必须要有一个前台进程，docker发现没有应用，就会自动停止</span></span><br><span class="line"><span class="comment"># nginx， 容器启动后，发现自己没有提供服务，就会立即停止，就是没有程序了</span></span><br></pre></td></tr></table></figure>

<p><strong>查看日志</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">docker logs --<span class="built_in">help</span></span><br><span class="line">Options:</span><br><span class="line">--details Show extra details provided to logs</span><br><span class="line">* -f, --follow Follow <span class="built_in">log</span> output</span><br><span class="line">--since string Show logs since timestamp (e.g. 2013-01-02T13:23:37) or relative (e.g. 42m <span class="keyword">for</span> 42 minutes)</span><br><span class="line">* --<span class="built_in">tail</span> string Number of lines to show from the end of the logs (default <span class="string">&quot;all&quot;</span>)</span><br><span class="line">* -t, --timestamps Show timestamps</span><br><span class="line">--until string Show logs before a timestamp (e.g. 2013-01-02T13:23:37) or relative (e.g. 42m <span class="keyword">for</span> 42 minutes)</span><br><span class="line"></span><br><span class="line">docker logs -tf --<span class="built_in">tail</span> number 容器<span class="built_in">id</span></span><br><span class="line"> </span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ /]<span class="comment"># docker logs -tf --tail 1 8d1621e09bff</span></span><br><span class="line">2020-08-11T10:53:15.987702897Z [root@8d1621e09bff /]<span class="comment"># exit      # 日志输出</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 自己编写一段shell脚本</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ /]<span class="comment"># docker run -d centos /bin/sh -c &quot;while true;do echo xiaofan;sleep 1;done&quot;</span></span><br><span class="line">a0d580a21251da97bc050763cf2d5692a455c228fa2a711c3609872008e654c2</span><br><span class="line"> </span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ /]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">a0d580a21251        centos              <span class="string">&quot;/bin/sh -c &#x27;while t…&quot;</span>   3 seconds ago       Up 1 second                             lucid_black</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 显示日志</span></span><br><span class="line">-tf                 <span class="comment"># 显示日志（一直更新）</span></span><br><span class="line">--<span class="built_in">tail</span> number       <span class="comment"># 显示日志条数</span></span><br><span class="line"></span><br><span class="line">docker logs -t --<span class="built_in">tail</span> n 容器<span class="built_in">id</span>  <span class="comment">#查看n行日志</span></span><br><span class="line">docker logs -ft 容器<span class="built_in">id</span>          <span class="comment">#跟着日志</span></span><br><span class="line"></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ /]<span class="comment"># docker logs -tf --tail 10 a0d580a21251</span></span><br></pre></td></tr></table></figure>

<p><strong>查看容器中进程信息</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 命令 docker top 容器id</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ /]<span class="comment"># docker top df358bc06b17</span></span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY     </span><br><span class="line">root                28498               28482               0                   19:38               ?      </span><br></pre></td></tr></table></figure>

<p><strong>查看镜像的元数据</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 命令</span></span><br><span class="line">docker inspect 容器<span class="built_in">id</span></span><br><span class="line"> </span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ /]<span class="comment"># docker inspect df358bc06b17</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;df358bc06b17ef44f215d35d9f46336b28981853069a3739edfc6bd400f99bf3&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2020-08-11T11:38:34.935048603Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Path&quot;</span>: <span class="string">&quot;/bin/bash&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Args&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;State&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Status&quot;</span>: <span class="string">&quot;running&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Running&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;Paused&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Restarting&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;OOMKilled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Dead&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Pid&quot;</span>: 28498,</span><br><span class="line">            <span class="string">&quot;ExitCode&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;Error&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;StartedAt&quot;</span>: <span class="string">&quot;2020-08-11T11:38:35.216616071Z&quot;</span>,</span><br><span class="line">            <span class="string">&quot;FinishedAt&quot;</span>: <span class="string">&quot;0001-01-01T00:00:00Z&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;sha256:0d120b6ccaa8c5e149176798b3501d4dd1885f961922497cd0abef155c869566&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ResolvConfPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/df358bc06b17ef44f215d35d9f46336b28981853069a3739edfc6bd400f99bf3/resolv.conf&quot;</span>,</span><br><span class="line">        <span class="string">&quot;HostnamePath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/df358bc06b17ef44f215d35d9f46336b28981853069a3739edfc6bd400f99bf3/hostname&quot;</span>,</span><br><span class="line">        <span class="string">&quot;HostsPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/df358bc06b17ef44f215d35d9f46336b28981853069a3739edfc6bd400f99bf3/hosts&quot;</span>,</span><br><span class="line">        <span class="string">&quot;LogPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/df358bc06b17ef44f215d35d9f46336b28981853069a3739edfc6bd400f99bf3/df358bc06b17ef44f215d35d9f46336b28981853069a3739edfc6bd400f99bf3-json.log&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;/hungry_heisenberg&quot;</span>,</span><br><span class="line">        <span class="string">&quot;RestartCount&quot;</span>: 0,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;overlay2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Platform&quot;</span>: <span class="string">&quot;linux&quot;</span>,</span><br><span class="line">        <span class="string">&quot;MountLabel&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ProcessLabel&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;AppArmorProfile&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ExecIDs&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;HostConfig&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Binds&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;ContainerIDFile&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;LogConfig&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;json-file&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Config&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;NetworkMode&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;PortBindings&quot;</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">&quot;RestartPolicy&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;no&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MaximumRetryCount&quot;</span>: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;AutoRemove&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;VolumeDriver&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;VolumesFrom&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CapAdd&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CapDrop&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Capabilities&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Dns&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;DnsOptions&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;DnsSearch&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;ExtraHosts&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;GroupAdd&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;IpcMode&quot;</span>: <span class="string">&quot;private&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Cgroup&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Links&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;OomScoreAdj&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;PidMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Privileged&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;PublishAllPorts&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;ReadonlyRootfs&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;SecurityOpt&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;UTSMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;UsernsMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ShmSize&quot;</span>: 67108864,</span><br><span class="line">            <span class="string">&quot;Runtime&quot;</span>: <span class="string">&quot;runc&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ConsoleSize&quot;</span>: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Isolation&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;CpuShares&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;Memory&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;NanoCpus&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CgroupParent&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;BlkioWeight&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;BlkioWeightDevice&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;BlkioDeviceReadBps&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;BlkioDeviceWriteBps&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;BlkioDeviceReadIOps&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;BlkioDeviceWriteIOps&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CpuPeriod&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuQuota&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuRealtimePeriod&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuRealtimeRuntime&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpusetCpus&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;CpusetMems&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Devices&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;DeviceCgroupRules&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;DeviceRequests&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;KernelMemory&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;KernelMemoryTCP&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;MemoryReservation&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;MemorySwap&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;MemorySwappiness&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;OomKillDisable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;PidsLimit&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Ulimits&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CpuCount&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuPercent&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;IOMaximumIOps&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;IOMaximumBandwidth&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;MaskedPaths&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;/proc/asound&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/acpi&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/kcore&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/keys&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/latency_stats&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/timer_list&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/timer_stats&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/sched_debug&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/scsi&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/sys/firmware&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;ReadonlyPaths&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;/proc/bus&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/fs&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/irq&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/sys&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/sysrq-trigger&quot;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;GraphDriver&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Data&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;LowerDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/5af8a2aadbdba9e1e066331ff4bce56398617710a22ef906f9ce4d58bde2d360-init/diff:/var/lib/docker/overlay2/62926d498bd9d1a6684bb2f9920fb77a2f88896098e66ef93c4b74fcb19f29b6/diff&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MergedDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/5af8a2aadbdba9e1e066331ff4bce56398617710a22ef906f9ce4d58bde2d360/merged&quot;</span>,</span><br><span class="line">                <span class="string">&quot;UpperDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/5af8a2aadbdba9e1e066331ff4bce56398617710a22ef906f9ce4d58bde2d360/diff&quot;</span>,</span><br><span class="line">                <span class="string">&quot;WorkDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/5af8a2aadbdba9e1e066331ff4bce56398617710a22ef906f9ce4d58bde2d360/work&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;overlay2&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Mounts&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;Config&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Hostname&quot;</span>: <span class="string">&quot;df358bc06b17&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Domainname&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;User&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;AttachStdin&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;AttachStdout&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;AttachStderr&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;Tty&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;OpenStdin&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;StdinOnce&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;Env&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Cmd&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;/bin/bash&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;centos&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Volumes&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;WorkingDir&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Entrypoint&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;OnBuild&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Labels&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;org.label-schema.build-date&quot;</span>: <span class="string">&quot;20200809&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.label-schema.license&quot;</span>: <span class="string">&quot;GPLv2&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.label-schema.name&quot;</span>: <span class="string">&quot;CentOS Base Image&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.label-schema.schema-version&quot;</span>: <span class="string">&quot;1.0&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.label-schema.vendor&quot;</span>: <span class="string">&quot;CentOS&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;NetworkSettings&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Bridge&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;SandboxID&quot;</span>: <span class="string">&quot;4822f9ac2058e8415ebefbfa73f05424fe20cc8280a5720ad3708fa6e80cdb08&quot;</span>,</span><br><span class="line">            <span class="string">&quot;HairpinMode&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;LinkLocalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;LinkLocalIPv6PrefixLen&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;Ports&quot;</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">&quot;SandboxKey&quot;</span>: <span class="string">&quot;/var/run/docker/netns/4822f9ac2058&quot;</span>,</span><br><span class="line">            <span class="string">&quot;SecondaryIPAddresses&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;SecondaryIPv6Addresses&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;5fd269c0a28227241e40cd30658e3ffe8ad6cc3e6514917c867d89d36a31d605&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.17.0.2&quot;</span>,</span><br><span class="line">            <span class="string">&quot;IPPrefixLen&quot;</span>: 16,</span><br><span class="line">            <span class="string">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Networks&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;bridge&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;IPAMConfig&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;Links&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;Aliases&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;NetworkID&quot;</span>: <span class="string">&quot;30d6017888627cb565618b1639fecf8fc97e1ae4df5a9fd5ddb046d8fb02b565&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;5fd269c0a28227241e40cd30658e3ffe8ad6cc3e6514917c867d89d36a31d605&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.17.0.2&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;IPPrefixLen&quot;</span>: 16,</span><br><span class="line">                    <span class="string">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,</span><br><span class="line">                    <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;DriverOpts&quot;</span>: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>进入当前正在运行的容器</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 我们通常容器使用后台方式运行的， 需要进入容器，修改一些配置</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 命令</span></span><br><span class="line">docker <span class="built_in">exec</span> -it 容器<span class="built_in">id</span> /bin/bash</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ /]<span class="comment"># docker exec -it df358bc06b17 /bin/bash</span></span><br><span class="line">[root@df358bc06b17 /]<span class="comment"># ls       </span></span><br><span class="line">bin  etc   lib    lost+found  mnt  proc  run   srv  tmp  var</span><br><span class="line">dev  home  lib64  media       opt  root  sbin  sys  usr</span><br><span class="line">[root@df358bc06b17 /]<span class="comment"># ps -ef</span></span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         1     0  0 Aug11 pts/0    00:00:00 /bin/bash</span><br><span class="line">root        29     0  0 01:06 pts/1    00:00:00 /bin/bash</span><br><span class="line">root        43    29  0 01:06 pts/1    00:00:00 ps -ef</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 方式二</span></span><br><span class="line">docker attach 容器<span class="built_in">id</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># docker exec       # 进入容器后开启一个新的终端，可以在里面操作（常用）</span></span><br><span class="line"><span class="comment"># docker attach     # 进入容器正在执行的终端，不会启动新的进程</span></span><br></pre></td></tr></table></figure>

<p><strong>从容器中拷贝文件到主机</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">cp</span> 容器<span class="built_in">id</span>：容器内路径    目的地主机路径</span><br><span class="line"> </span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ /]<span class="comment"># docker cp 7af535f807e0:/home/Test.java /home</span></span><br><span class="line"></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span><br><span class="line">56a5583b25b4 centos <span class="string">&quot;/bin/bash&quot;</span> 7seconds ago Up 6 seconds</span><br><span class="line"></span><br><span class="line"><span class="comment">#1. 进入docker容器内部</span></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z ~]<span class="comment"># docker exec -it 56a5583b25b4 /bin/bash</span></span><br><span class="line">[root@55321bcae33d /]<span class="comment"># ls</span></span><br><span class="line">bin dev etc home lib lib64 lost+found media mnt opt proc root run sbin srv sys tmp usr var</span><br><span class="line"></span><br><span class="line"><span class="comment">#新建一个文件</span></span><br><span class="line">[root@55321bcae33d /]<span class="comment"># echo &quot;hello&quot; &gt; java.java</span></span><br><span class="line">[root@55321bcae33d /]<span class="comment"># cat hello.java</span></span><br><span class="line">hello</span><br><span class="line">[root@55321bcae33d /]<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#hello.java拷贝到home文件加下</span></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z /]<span class="comment"># docker cp 56a5583b25b4:/hello.java /home</span></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z /]<span class="comment"># cd /home</span></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z home]<span class="comment"># ls -l #可以看见java.java存在</span></span><br><span class="line">total 8</span><br><span class="line">-rw-r--r-- 1 root root 0 May 19 22:09 haust.java</span><br><span class="line">-rw-r--r-- 1 root root 6 May 22 11:12 java.java</span><br><span class="line">drwx------ 3 www www 4096 May 8 12:14 www</span><br></pre></td></tr></table></figure>

<p><strong>小结</strong></p>
<p><img src="/2022/10/17/Docker/174493-20210829002637397-695197227.png" alt="img"></p>
<p><strong>命令大全</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">attach Attach <span class="built_in">local</span> standard input, output, and error streams to a running container</span><br><span class="line"><span class="comment">#当前shell下 attach连接指定运行的镜像</span></span><br><span class="line">build Build an image from a Dockerfile <span class="comment"># 通过Dockerfile定制镜像</span></span><br><span class="line">commit Create a new image from a container<span class="string">&#x27;s changes #提交当前容器为新的镜像</span></span><br><span class="line"><span class="string">cp Copy files/folders between a container and the local filesystem #拷贝文件</span></span><br><span class="line"><span class="string">create Create a new container #创建一个新的容器</span></span><br><span class="line"><span class="string">diff Inspect changes to files or directories on a container&#x27;</span>s filesystem <span class="comment">#查看docker容器的变化</span></span><br><span class="line">events Get real time events from the server <span class="comment"># 从服务获取容器实时时间</span></span><br><span class="line"><span class="built_in">exec</span> Run a <span class="built_in">command</span> <span class="keyword">in</span> a running container <span class="comment"># 在运行中的容器上运行命令</span></span><br><span class="line"><span class="built_in">export</span> Export a container<span class="string">&#x27;s filesystem as a tar archive #导出容器文件系统作为一个tar归档文件[对应import]</span></span><br><span class="line"><span class="string">history Show the history of an image # 展示一个镜像形成历史</span></span><br><span class="line"><span class="string">images List images #列出系统当前的镜像</span></span><br><span class="line"><span class="string">import Import the contents from a tarball to create a filesystem image #从tar包中导入内容创建一个文件系统镜像</span></span><br><span class="line"><span class="string">info Display system-wide information # 显示全系统信息</span></span><br><span class="line"><span class="string">inspect Return low-level information on Docker objects #查看容器详细信息</span></span><br><span class="line"><span class="string">kill Kill one or more running containers # kill指定docker容器</span></span><br><span class="line"><span class="string">load Load an image from a tar archive or STDIN #从一个tar包或标准输入中加载一个镜像[对应save]</span></span><br><span class="line"><span class="string">login Log in to a Docker registry #</span></span><br><span class="line"><span class="string">logout Log out from a Docker registry</span></span><br><span class="line"><span class="string">logs Fetch the logs of a container</span></span><br><span class="line"><span class="string">pause Pause all processes within one or more containers</span></span><br><span class="line"><span class="string">port List port mappings or a specific mapping for the container</span></span><br><span class="line"><span class="string">ps List containers</span></span><br><span class="line"><span class="string">pull Pull an image or a repository from a registry</span></span><br><span class="line"><span class="string">push Push an image or a repository to a registry</span></span><br><span class="line"><span class="string">rename Rename a container</span></span><br><span class="line"><span class="string">restart Restart one or more containers</span></span><br><span class="line"><span class="string">rm Remove one or more containers</span></span><br><span class="line"><span class="string">rmi Remove one or more images</span></span><br><span class="line"><span class="string">run Run a command in a new container</span></span><br><span class="line"><span class="string">save Save one or more images to a tar archive (streamed to STDOUT by default)</span></span><br><span class="line"><span class="string">search Search the Docker Hub for images</span></span><br><span class="line"><span class="string">start Start one or more stopped containers</span></span><br><span class="line"><span class="string">stats Display a live stream of container(s) resource usage statistics</span></span><br><span class="line"><span class="string">stop Stop one or more running containers</span></span><br><span class="line"><span class="string">tag Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span></span><br><span class="line"><span class="string">top Display the running processes of a container</span></span><br><span class="line"><span class="string">unpause Unpause all processes within one or more containers</span></span><br><span class="line"><span class="string">update Update configuration of one or more containers</span></span><br><span class="line"><span class="string">version Show the Docker version information</span></span><br><span class="line"><span class="string">wait Block until one or more containers stop, then print their exit codes</span></span><br></pre></td></tr></table></figure>

<h1 id="三、Docker部署软件实战"><a href="#三、Docker部署软件实战" class="headerlink" title="三、Docker部署软件实战"></a>三、Docker部署软件实战</h1><h2 id="1-Docker部署软件实战"><a href="#1-Docker部署软件实战" class="headerlink" title="1.Docker部署软件实战"></a>1.Docker部署软件实战</h2><h4 id="Docker安装Nginx"><a href="#Docker安装Nginx" class="headerlink" title="Docker安装Nginx"></a>Docker安装Nginx</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1. 搜索镜像 search 建议大家去docker搜索，可以看到帮助文档</span></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z ~]<span class="comment"># docker search nginx</span></span><br><span class="line"><span class="comment">#2. 拉取下载镜像 pull</span></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z ~]<span class="comment"># docker pull nginx</span></span><br><span class="line"><span class="comment">#3. 查看是否下载成功镜像</span></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z ~]<span class="comment"># docker images</span></span><br><span class="line"><span class="comment">#3. 运行测试</span></span><br><span class="line"><span class="comment"># -d 后台运行</span></span><br><span class="line"><span class="comment"># --name 给容器命名</span></span><br><span class="line"><span class="comment"># -p 宿主机端口：容器内部端口</span></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z ~]<span class="comment"># docker run -d --name nginx01 -p 3344:80 nginx</span></span><br><span class="line">aa664b0c8ed98f532453ce1c599be823bcc1f3c9209e5078615af416ccb454c2</span><br><span class="line"><span class="comment">#4. 查看正在启动的镜像</span></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span><br><span class="line">75943663c116 nginx <span class="string">&quot;nginx -g &#x27;daemon of…&quot;</span> 41 seconds ago Up 40 seconds 0.0.0.0:82-&gt;80/tcp nginx00</span><br><span class="line"><span class="comment">#5. 进入容器</span></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z ~]<span class="comment"># docker exec -it nginx01 /bin/bash #进入</span></span><br><span class="line">root@aa664b0c8ed9:/<span class="comment"># whereis nginx #找到nginx位置</span></span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br><span class="line">root@aa664b0c8ed9:/<span class="comment"># cd /etc/nginx/</span></span><br><span class="line">root@aa664b0c8ed9:/etc/nginx<span class="comment"># ls</span></span><br><span class="line">conf.d fastcgi_params koi-utf koi-win mime.types modules nginx.conf scgi_params uwsgi_params win-utf</span><br><span class="line"><span class="comment">#6. 退出容器</span></span><br><span class="line">root@aa664b0c8ed9:/etc/nginx<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="comment">#7. 停止容器</span></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</span><br><span class="line">aa664b0c8ed9 nginx <span class="string">&quot;nginx -g &#x27;daemon of…&quot;</span> 10 minutes ago Up 10 minutes 0.0.0.0:3344-&gt;80/tcp nginx01</span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z ~]<span class="comment"># docker stop aa664b0c8ed9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##################### 其它 ###########################</span></span><br><span class="line"><span class="comment"># 1. 搜索镜像 search 建议去docker hub搜索，可以看到帮助文档</span></span><br><span class="line"><span class="comment"># 2. 下载镜像 pull</span></span><br><span class="line"><span class="comment"># 3. 运行测试</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ home]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos              latest              0d120b6ccaa8        32 hours ago        215MB</span><br><span class="line">nginx               latest              08393e824c32        7 days ago          132MB</span><br><span class="line"> </span><br><span class="line"><span class="comment"># -d 后台运行</span></span><br><span class="line"><span class="comment"># -name 给容器命名</span></span><br><span class="line"><span class="comment"># -p 宿主机端口：容器内部端口</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ home]<span class="comment"># docker run -d --name nginx01 -p 3344:80 nginx  # 后台方式启动启动镜像</span></span><br><span class="line">fe9dc33a83294b1b240b1ebb0db9cb16bda880737db2c8a5c0a512fc819850e0</span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ home]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">fe9dc33a8329        nginx               <span class="string">&quot;/docker-entrypoint.…&quot;</span>   4 seconds ago       Up 4 seconds        0.0.0.0:3344-&gt;80/tcp   nginx01</span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ home]<span class="comment"># curl localhost:3344    # 本地访问测试</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 进入容器</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ home]<span class="comment"># docker exec -it nginx01 /bin/bash</span></span><br><span class="line">root@fe9dc33a8329:/<span class="comment"># whereis nginx</span></span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br><span class="line">root@fe9dc33a8329:/<span class="comment"># cd /etc/nginx/</span></span><br><span class="line">root@fe9dc33a8329:/etc/nginx<span class="comment"># ls</span></span><br><span class="line">conf.d      koi-utf  mime.types  nginx.conf   uwsgi_params</span><br><span class="line">fastcgi_params  koi-win  modules     scgi_params  win-utf</span><br></pre></td></tr></table></figure>

<p><strong>端口暴露概念</strong></p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70-166596967888736.png" alt="在这里插入图片描述"></p>
<h2 id="2-Docker安装Tomcat"><a href="#2-Docker安装Tomcat" class="headerlink" title="2.Docker安装Tomcat"></a>2.Docker安装Tomcat</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载 tomcat9.0</span></span><br><span class="line"><span class="comment"># 之前的启动都是后台，停止了容器，容器还是可以查到， docker run -it --rm 镜像名 一般是用来测试，用完就删除</span></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z ~]<span class="comment"># docker run -it --rm tomcat:9.0</span></span><br><span class="line">--<span class="built_in">rm</span> Automatically remove the container when it exits 用完即删</span><br><span class="line"><span class="comment">#下载 最新版</span></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z ~]<span class="comment"># docker pull tomcat</span></span><br><span class="line"><span class="comment">#查看下载的镜像</span></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z ~]<span class="comment"># docker images</span></span><br><span class="line"><span class="comment">#以后台方式，暴露端口方式，启动运行</span></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z ~]<span class="comment"># docker run -d -p 8080:8080 --name tomcat01 tomcat</span></span><br><span class="line"><span class="comment">#测试访问有没有问题</span></span><br><span class="line">curl localhost:8080</span><br><span class="line"><span class="comment">#根据容器id进入tomcat容器</span></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z ~]<span class="comment"># docker exec -it 645596565d3f /bin/bash</span></span><br><span class="line">root@645596565d3f:/usr/local/tomcat<span class="comment">#</span></span><br><span class="line"><span class="comment">#查看tomcat容器内部内容：</span></span><br><span class="line">root@645596565d3f:/usr/local/tomcat<span class="comment"># ls -l</span></span><br><span class="line">total 152</span><br><span class="line">-rw-r--r-- 1 root root 18982 May 5 20:40 BUILDING.txt</span><br><span class="line">-rw-r--r-- 1 root root 5409 May 5 20:40 CONTRIBUTING.md</span><br><span class="line">-rw-r--r-- 1 root root 57092 May 5 20:40 LICENSE</span><br><span class="line">-rw-r--r-- 1 root root 2333 May 5 20:40 NOTICE</span><br><span class="line">-rw-r--r-- 1 root root 3255 May 5 20:40 README.md</span><br><span class="line">-rw-r--r-- 1 root root 6898 May 5 20:40 RELEASE-NOTES</span><br><span class="line">-rw-r--r-- 1 root root 16262 May 5 20:40 RUNNING.txt</span><br><span class="line">drwxr-xr-x 2 root root 4096 May 16 12:05 bin</span><br><span class="line">drwxr-xr-x 1 root root 4096 May 21 11:04 conf</span><br><span class="line">drwxr-xr-x 2 root root 4096 May 16 12:05 lib</span><br><span class="line">drwxrwxrwx 1 root root 4096 May 21 11:04 logs</span><br><span class="line">drwxr-xr-x 2 root root 4096 May 16 12:05 native-jni-lib</span><br><span class="line">drwxrwxrwx 2 root root 4096 May 16 12:05 temp</span><br><span class="line">drwxr-xr-x 2 root root 4096 May 16 12:05 webapps</span><br><span class="line">drwxr-xr-x 7 root root 4096 May 5 20:37 webapps.dist</span><br><span class="line">drwxrwxrwx 2 root root 4096 May 5 20:36 work</span><br><span class="line">root@645596565d3f:/usr/local/tomcat<span class="comment">#</span></span><br><span class="line"><span class="comment">#进入webapps目录</span></span><br><span class="line">root@645596565d3f:/usr/local/tomcat<span class="comment"># cd webapps</span></span><br><span class="line">root@645596565d3f:/usr/local/tomcat/webapps<span class="comment"># ls</span></span><br><span class="line">root@645596565d3f:/usr/local/tomcat/webapps<span class="comment">#</span></span><br><span class="line"><span class="comment"># 发现问题：1、linux命令少了。 2.webapps目录为空</span></span><br><span class="line"><span class="comment"># 原因：阿里云镜像的原因，阿里云默认是最小的镜像，所以不必要的都剔除掉</span></span><br><span class="line"><span class="comment"># 保证最小可运行的环境！</span></span><br><span class="line"><span class="comment"># 解决方案：</span></span><br><span class="line"><span class="comment"># 将webapps.dist下的文件都拷贝到webapps下即可</span></span><br><span class="line">root@645596565d3f:/usr/local/tomcat<span class="comment"># ls 找到webapps.dist</span></span><br><span class="line">BUILDING.txt LICENSE README.md RUNNING.txt conf logs temp webapps.dist</span><br><span class="line">CONTRIBUTING.md NOTICE RELEASE-NOTES bin lib native-jni-lib webapps work</span><br><span class="line">root@645596565d3f:/usr/local/tomcat<span class="comment"># cd webapps.dist/ # 进入webapps.dist</span></span><br><span class="line">root@645596565d3f:/usr/local/tomcat/webapps.dist<span class="comment"># ls # 查看内容</span></span><br><span class="line">ROOT docs examples host-manager manager</span><br><span class="line">root@645596565d3f:/usr/local/tomcat/webapps.dist<span class="comment"># cd ..</span></span><br><span class="line">root@645596565d3f:/usr/local/tomcat<span class="comment"># cp -r webapps.dist/* webapps # 拷贝webapps.dist 内容给webapps</span></span><br><span class="line">root@645596565d3f:/usr/local/tomcat<span class="comment"># cd webapps #进入webapps</span></span><br><span class="line">root@645596565d3f:/usr/local/tomcat/webapps<span class="comment"># ls #查看拷贝结果</span></span><br><span class="line">ROOT docs examples host-manager manager</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">####################### 其它 ##########################</span></span><br><span class="line"><span class="comment"># 官方的使用</span></span><br><span class="line">docker run -it --<span class="built_in">rm</span> tomcat:9.0</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 我们之前的启动都是后台的，停止了容器之后， 容器还是可以查到，docker run -it --rm 一般用来测试，用完就删</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 下载再启动</span></span><br><span class="line">docker pull tomcat</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 启动运行</span></span><br><span class="line">docker run -d -p 3344:8080 --name tomcat01 tomcat</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 测试访问没有问题</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 进入容器</span></span><br><span class="line">docker <span class="built_in">exec</span> -it tomcat01 /bin/bash</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 发现问题：1.linux命令少了， 2. webapps下内容为空，阿里云净吸纳过默认是最小的镜像，所有不必要的都剔除了，保证最小可运行环境即可</span></span><br></pre></td></tr></table></figure>

<h4 id="这样-docker-部署-tomcat-就可以访问了"><a href="#这样-docker-部署-tomcat-就可以访问了" class="headerlink" title="这样 docker 部署 tomcat 就可以访问了"></a>这样 docker 部署 tomcat 就可以访问了</h4><p><img src="/2022/10/17/Docker/174493-20210829003420851-954161404.png" alt="img"></p>
<p>问题：我们以后要部署项目，如果每次都要进入容器是不是十分麻烦？要是可以在容器外部提供一个映射路径，比如webapps，我们在外部放置项目，就自动同步内部就好了！</p>
<h2 id="3-Docker-部署-elasticsearch-kibana"><a href="#3-Docker-部署-elasticsearch-kibana" class="headerlink" title="3.Docker 部署 elasticsearch + kibana"></a>3.Docker 部署 elasticsearch + kibana</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># es 暴露的端口很多</span></span><br><span class="line"><span class="comment"># es 十分的耗内存</span></span><br><span class="line"><span class="comment"># es 的数据一般需要放置到安全目录！ 挂载</span></span><br><span class="line"><span class="comment"># --net somenetwork 网络配置</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 启动elasticsearch</span></span><br><span class="line">docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e <span class="string">&quot;discovery.type=single-node&quot;</span> elasticsearch:7.6.2</span><br><span class="line"> </span><br><span class="line">[root@ihome]<span class="comment"># docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:7.6.2</span></span><br><span class="line">a920894a940b354d3c867079efada13d96cf9138712c76c8dea58fabd9c7e96f</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 启动了linux就卡主了，docker stats 查看cpu状态</span></span><br><span class="line">[root@i]<span class="comment"># docker stats # 查看docker容器使用内存情况</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 测试一下es成功了</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ home]<span class="comment"># curl localhost:9200</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span> : <span class="string">&quot;a920894a940b&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;docker-cluster&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;bxE1TJMEThKgwmk7Aa3fHQ&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;number&quot;</span> : <span class="string">&quot;7.6.2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_flavor&quot;</span> : <span class="string">&quot;default&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_type&quot;</span> : <span class="string">&quot;docker&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_hash&quot;</span> : <span class="string">&quot;ef48eb35cf30adf4db14086e8aabd07ef6fb113f&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_date&quot;</span> : <span class="string">&quot;2020-03-26T06:34:37.794943Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_snapshot&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;lucene_version&quot;</span> : <span class="string">&quot;8.4.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_wire_compatibility_version&quot;</span> : <span class="string">&quot;6.8.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_index_compatibility_version&quot;</span> : <span class="string">&quot;6.0.0-beta1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;tagline&quot;</span> : <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">#测试成功就关掉elasticSearch，防止耗内存</span></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z ~]<span class="comment"># docker stop d834ce2bd306</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试成功就关掉elasticSearch，删除正在运行的镜像</span></span><br><span class="line">docker <span class="built_in">rm</span> -f d73ad2f22dd3 <span class="comment"># stop命令也行 </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加内存限制，修改配置文件 -e 环境配置修改</span></span><br><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e <span class="string">&quot;discovery.type=single-node&quot;</span> -e ES_JAVA_OPTS=<span class="string">&quot;-Xms64m -Xmx512m&quot;</span> elasticsearch:7.6.2</span><br></pre></td></tr></table></figure>

<h4 id="作业三：使用-kibana-连接-es-（elasticSearch）？思考网路如何才能连接"><a href="#作业三：使用-kibana-连接-es-（elasticSearch）？思考网路如何才能连接" class="headerlink" title="作业三：使用 kibana 连接 es （elasticSearch）？思考网路如何才能连接"></a>作业三：使用 kibana 连接 es （elasticSearch）？思考网路如何才能连接</h4><p><img src="/2022/10/17/Docker/174493-20210829093735715-1170950147.png" alt="img"></p>
<h4 id="Portainer-可视化面板安装"><a href="#Portainer-可视化面板安装" class="headerlink" title="Portainer 可视化面板安装"></a>Portainer 可视化面板安装</h4><ul>
<li>portainer（先用这个）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8080:9000 \</span><br><span class="line">--restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=<span class="literal">true</span> portainer/portainer</span><br></pre></td></tr></table></figure>

<p>Rancher(CI&#x2F;CD再用)</p>
<p><strong>什么是portainer</strong></p>
<p><strong>Docker 图形化界面管理工具！提供一个后台面板供我们操作</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装命令</span></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z ~]<span class="comment"># docker run -d -p 8080:9000 \</span></span><br><span class="line">  --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=<span class="literal">true</span> portainer/portainer</span><br><span class="line">Unable to find image <span class="string">&#x27;portainer/portainer:latest&#x27;</span> locally</span><br><span class="line">latest: Pulling from portainer/portainer</span><br><span class="line">d1e017099d17: Pull complete</span><br><span class="line">a7dca5b5a9e8: Pull complete</span><br><span class="line">Digest: sha256:4ae7f14330b56ffc8728e63d355bc4bc7381417fa45ba0597e5dd32682901080</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> portainer/portainer:latest</span><br><span class="line">81753869c4fd438cec0e31659cbed0d112ad22bbcfcb9605483b126ee8ff306d</span><br></pre></td></tr></table></figure>

<p>测试访问：  外网：8080 ：<a target="_blank" rel="noopener" href="http://123.56.247.59:8080/">http://123.56.247.59:8080/</a></p>
<p><img src="/2022/10/17/Docker/174493-20210829094610593-1468694109.png" alt="img"></p>
<p><strong>进入面板之后</strong></p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70-166596973342245.png" alt="在这里插入图片描述"></p>
<h1 id="四、Docker-原理"><a href="#四、Docker-原理" class="headerlink" title="四、Docker 原理"></a>四、Docker 原理</h1><h2 id="镜像原理之联合文件系统"><a href="#镜像原理之联合文件系统" class="headerlink" title="镜像原理之联合文件系统"></a>镜像原理之联合文件系统</h2><p><strong>镜像是什么</strong></p>
<p>镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时库、环境变量和配置文件。</p>
<p>所有应用，直接打包 docker 镜像，就可以直接跑起来！</p>
<p><strong>如何得到镜像</strong></p>
<ul>
<li>从远程仓库下载</li>
<li>别人拷贝给你</li>
<li>自己制作一个镜像 Dockerfile</li>
</ul>
<p><strong>Docker 镜像加载原理</strong></p>
<blockquote>
<p>UnionFs（联合文件系统）</p>
</blockquote>
<p>UnionFs （联合文件系统）：Union 文件系统（UnionFs）是一种分层、轻量级并且高性能的文件系统，他支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下（unite serveral directories into a single virtual filesystem)。Union 文件系统是 Docker 镜像的基础。镜像可以通过分成来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像</p>
<p>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合记载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</p>
<blockquote>
<p>docker 镜像加载原理</p>
</blockquote>
<p>docker 的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。</p>
<p>boots（boot file system）主要包含 bootloade 和 Kernel，bootloade主要是引导加载 kernel，Linux刚启动时会加载 bootfs 文件系统，在 Docker 镜像的最底层是 boots。这一层与我们典型的 Linux&#x2F;Unix 系统是一样的，包含 boot 加载器和内核。当 boot 加载完成之后整个内核就都在内存中了，此时内存的使用权已由 bootfs 转交给内核，此时系统也会卸载 bootfs。</p>
<p>rootfs （root file sysytem），在 bootfs 之上。包含的就是典型 Linux 系统中的&#x2F;dev,&#x2F;proc,&#x2F;bin,&#x2F;etc等标准目录和文件。rootfs 就是各种不同的操作系统发行版，比如 Ubuntu，CentOS 等等。</p>
<p><img src="/2022/10/17/Docker/174493-20210829100256180-434072911.png" alt="img"></p>
<p>平时我们安装进虚拟机的 CentOS 都是好几个G，为什么 Docker 这里才200M？</p>
<p><img src="/2022/10/17/Docker/174493-20210829100351306-1425842730.png" alt="img"></p>
<p>对于精简的 OS，rootfs 可以很小，只需要包含最基本的命令，工具和程序库就可以了，因为底层直接用 Host 的 kernel，自己只需要提供 rootfs 就可以了。由此可见对于不同的 Linux 发行版，bootfs 基本是一致的，rootfs 会有差别，因此不同的发行版可以公用 bootfs。</p>
<p>虚拟机是分钟级别的，容器是秒级！</p>
<p><strong>分层理解</strong></p>
<blockquote>
<p>分层镜像</p>
</blockquote>
<p>我们可以去下一个镜像，注意观察下载的日志输出，可以看到的是一层层的在下载</p>
<p><img src="/2022/10/17/Docker/174493-20210829100438362-1946402782.png" alt="img"></p>
<p><strong>思考：为什么 Docker 镜像要采用这种分层的结构呢？</strong></p>
<p>最大的好处，我觉得莫过于资源共享了！比如有多个镜像都是从相同的 Base 镜像构建而来，那么宿主机只需在磁盘上保留一份 base 镜像，同时内存中也只需要加载一份 base 镜像，同时内存中也只需要加载一份 base 镜像，这样就可以为所有的容器服务了，而且镜像的每一层都可以被共享。查看镜像分层的方式可以通过 docker image inspect 命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看分层命令</span></span><br><span class="line">docker image inspect redis</span><br><span class="line">[</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;Id&quot;</span>: <span class="string">&quot;sha256:f9b9909726890b00d2098081642edf32e5211b7ab53563929a47f250bcdc1d7c&quot;</span>,</span><br><span class="line"><span class="string">&quot;RepoTags&quot;</span>: [</span><br><span class="line"><span class="string">&quot;redis:latest&quot;</span></span><br><span class="line">],</span><br><span class="line"><span class="string">&quot;RepoDigests&quot;</span>: [</span><br><span class="line"><span class="string">&quot;redis@sha256:399a9b17b8522e24fbe2fd3b42474d4bb668d3994153c4b5d38c3dafd5903e32&quot;</span></span><br><span class="line">],</span><br><span class="line"><span class="string">&quot;Parent&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;Comment&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2020-05-02T01:40:19.112130797Z&quot;</span>,</span><br><span class="line"><span class="string">&quot;Container&quot;</span>: <span class="string">&quot;d30c0bcea88561bc5139821227d2199bb027eeba9083f90c701891b4affce3bc&quot;</span>,</span><br><span class="line"><span class="string">&quot;ContainerConfig&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;Hostname&quot;</span>: <span class="string">&quot;d30c0bcea885&quot;</span>,</span><br><span class="line"><span class="string">&quot;Domainname&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;User&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;AttachStdin&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">&quot;AttachStdout&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">&quot;AttachStderr&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">&quot;ExposedPorts&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;6379/tcp&quot;</span>: &#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;Tty&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">&quot;OpenStdin&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">&quot;StdinOnce&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">&quot;Env&quot;</span>: [</span><br><span class="line"><span class="string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>,</span><br><span class="line"><span class="string">&quot;GOSU_VERSION=1.12&quot;</span>,</span><br><span class="line"><span class="string">&quot;REDIS_VERSION=6.0.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-6.0.1.tar.gz&quot;</span>,</span><br><span class="line"><span class="string">&quot;REDIS_DOWNLOAD_SHA=b8756e430479edc162ba9c44dc89ac394316cd482f2dc6b91bcd5fe12593f273&quot;</span></span><br><span class="line">],</span><br><span class="line"><span class="string">&quot;Cmd&quot;</span>: [</span><br><span class="line"><span class="string">&quot;/bin/sh&quot;</span>,</span><br><span class="line"><span class="string">&quot;-c&quot;</span>,</span><br><span class="line"><span class="string">&quot;#(nop) &quot;</span>,</span><br><span class="line"><span class="string">&quot;CMD [\&quot;redis-server\&quot;]&quot;</span></span><br><span class="line">],</span><br><span class="line"><span class="string">&quot;ArgsEscaped&quot;</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">&quot;Image&quot;</span>: <span class="string">&quot;sha256:704c602fa36f41a6d2d08e49bd2319ccd6915418f545c838416318b3c29811e0&quot;</span>,</span><br><span class="line"><span class="string">&quot;Volumes&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;/data&quot;</span>: &#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;WorkingDir&quot;</span>: <span class="string">&quot;/data&quot;</span>,</span><br><span class="line"><span class="string">&quot;Entrypoint&quot;</span>: [</span><br><span class="line"><span class="string">&quot;docker-entrypoint.sh&quot;</span></span><br><span class="line">],</span><br><span class="line"><span class="string">&quot;OnBuild&quot;</span>: null,</span><br><span class="line"><span class="string">&quot;Labels&quot;</span>: &#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;DockerVersion&quot;</span>: <span class="string">&quot;18.09.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;Config&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;Hostname&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;Domainname&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;User&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;AttachStdin&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">&quot;AttachStdout&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">&quot;AttachStderr&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">&quot;ExposedPorts&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;6379/tcp&quot;</span>: &#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;Tty&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">&quot;OpenStdin&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">&quot;StdinOnce&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">&quot;Env&quot;</span>: [</span><br><span class="line"><span class="string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>,</span><br><span class="line"><span class="string">&quot;GOSU_VERSION=1.12&quot;</span>,</span><br><span class="line"><span class="string">&quot;REDIS_VERSION=6.0.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-6.0.1.tar.gz&quot;</span>,</span><br><span class="line"><span class="string">&quot;REDIS_DOWNLOAD_SHA=b8756e430479edc162ba9c44dc89ac394316cd482f2dc6b91bcd5fe12593f273&quot;</span></span><br><span class="line">],</span><br><span class="line"><span class="string">&quot;Cmd&quot;</span>: [</span><br><span class="line"><span class="string">&quot;redis-server&quot;</span></span><br><span class="line">],</span><br><span class="line"><span class="string">&quot;ArgsEscaped&quot;</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">&quot;Image&quot;</span>: <span class="string">&quot;sha256:704c602fa36f41a6d2d08e49bd2319ccd6915418f545c838416318b3c29811e0&quot;</span>,</span><br><span class="line"><span class="string">&quot;Volumes&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;/data&quot;</span>: &#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;WorkingDir&quot;</span>: <span class="string">&quot;/data&quot;</span>,</span><br><span class="line"><span class="string">&quot;Entrypoint&quot;</span>: [</span><br><span class="line"><span class="string">&quot;docker-entrypoint.sh&quot;</span></span><br><span class="line">],</span><br><span class="line"><span class="string">&quot;OnBuild&quot;</span>: null,</span><br><span class="line"><span class="string">&quot;Labels&quot;</span>: null</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;Architecture&quot;</span>: <span class="string">&quot;amd64&quot;</span>,</span><br><span class="line"><span class="string">&quot;Os&quot;</span>: <span class="string">&quot;linux&quot;</span>,</span><br><span class="line"><span class="string">&quot;Size&quot;</span>: 104101893,</span><br><span class="line"><span class="string">&quot;VirtualSize&quot;</span>: 104101893,</span><br><span class="line"><span class="string">&quot;GraphDriver&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;Data&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;LowerDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/adea96bbe6518657dc2d4c6331a807eea70567144abda686588ef6c3bb0d778a/diff:/var/lib/docker/overlay2/66abd822d34dc6446e6bebe73721dfd1dc497c2c8063c43ffb8cf8140e2caeb6/diff:/var/lib/docker/overlay2/d19d24fb6a24801c5fa639c1d979d19f3f17196b3c6dde96d3b69cd2ad07ba8a/diff:/var/lib/docker/overlay2/a1e95aae5e09ca6df4f71b542c86c677b884f5280c1d3e3a1111b13644b221f9/diff:/var/lib/docker/overlay2/cd90f7a9cd0227c1db29ea992e889e4e6af057d9ab2835dd18a67a019c18bab4/diff&quot;</span>,</span><br><span class="line"><span class="string">&quot;MergedDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/afa1de233453b60686a3847854624ef191d7bc317fb01e015b4f06671139fb11/merged&quot;</span>,</span><br><span class="line"><span class="string">&quot;UpperDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/afa1de233453b60686a3847854624ef191d7bc317fb01e015b4f06671139fb11/diff&quot;</span>,</span><br><span class="line"><span class="string">&quot;WorkDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/afa1de233453b60686a3847854624ef191d7bc317fb01e015b4f06671139fb11/work&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;Name&quot;</span>: <span class="string">&quot;overlay2&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;RootFS&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;Type&quot;</span>: <span class="string">&quot;layers&quot;</span>,</span><br><span class="line"><span class="string">&quot;Layers&quot;</span>: [</span><br><span class="line"><span class="string">&quot;sha256:c2adabaecedbda0af72b153c6499a0555f3a769d52370469d8f6bd6328af9b13&quot;</span>,</span><br><span class="line"><span class="string">&quot;sha256:744315296a49be711c312dfa1b3a80516116f78c437367ff0bc678da1123e990&quot;</span>,</span><br><span class="line"><span class="string">&quot;sha256:379ef5d5cb402a5538413d7285b21aa58a560882d15f1f553f7868dc4b66afa8&quot;</span>,</span><br><span class="line"><span class="string">&quot;sha256:d00fd460effb7b066760f97447c071492d471c5176d05b8af1751806a1f905f8&quot;</span>,</span><br><span class="line"><span class="string">&quot;sha256:4d0c196331523cfed7bf5bafd616ecb3855256838d850b6f3d5fba911f6c4123&quot;</span>,</span><br><span class="line"><span class="string">&quot;sha256:98b4a6242af2536383425ba2d6de033a510e049d9ca07ff501b95052da76e894&quot;</span></span><br><span class="line">]</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;Metadata&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;LastTagTime&quot;</span>: <span class="string">&quot;0001-01-01T00:00:00Z&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>理解：</strong></p>
<p>所有的 Docker 镜像都起始于一个基础镜像层，当进行修改或增加新的内容时，就会在当前镜像层之上，创建新的镜像层。</p>
<p>举一个简单的例子，假如基于 Ubuntu Linux16.04 创建一个新的镜像，这就是镜像的第一层；如果在该镜像中添加 python 包，就会在基础镜像层之上创建第二个镜像层；如果继续添加一个安全补丁，就会创建第三个镜像层，该镜像当前已经包含三个镜像层，如下图所示（这只是一个用于演示的很简单的例子）。</p>
<p>在额外添加镜像层的同时，镜像始终保持是当前所有镜像的组合，理解这一点。</p>
<p><img src="/2022/10/17/Docker/174493-20210829101012761-1681983949.png" alt="img"></p>
<p>在额外添加镜像层的同时，镜像始终保持是当前所有镜像的组合，理解这一点非常重要。下图中举了一个简单的例子，每个镜像层包含了来自两个镜像层的6个问文件。</p>
<p><img src="/2022/10/17/Docker/174493-20210829101100618-501977461.png" alt="img"></p>
<p>上图的镜像层跟之前途中的略有区别，主要目的是便于展示文件</p>
<p>下图中展示了一个稍微复杂的三层镜像，在外部看来整个镜像只有6个文件，这是因为最上层中的文件7是文件5的一个更新版。</p>
<p><img src="/2022/10/17/Docker/174493-20210829101136921-1944421896.png" alt="img"></p>
<p>这种情况下，上层镜像层中的文件覆盖了底层镜像层中的文件。这样使得文件的更新版本作为以恶新镜像添加到镜像当中</p>
<p>Docker 通过存储引擎（新版本采用快照机制）的方式来实现镜像层堆栈，并保证多镜像曾对外展示为统一的文件系统</p>
<p>Linux 上可用的存储引擎有 AUFS、Overlay2、Device Mapper、Btrfs 以及 ZFS。顾名思义，每种存储引擎都是基于 Linux中对应的文件系统或者块设备技术，并且每种存储引擎都是具有其独有的性能特点。</p>
<p>Docker 在 windows 上仅支持 Windowsfilter 一种存储引擎，该引擎基于 NTFS 文件系统之上实现了分层和CoW。</p>
<p>下图展示了与系统显示相同的三层镜像。所有镜像层堆栈合并，对外提供统一的视图。</p>
<p><img src="/2022/10/17/Docker/174493-20210829101233602-319827004.png" alt="img"></p>
<blockquote>
<p>特点</p>
</blockquote>
<p>Docker 镜像都是只读的，当容器启动时，一个新的可写层加载到镜像的顶部！</p>
<p>这一层就是我们通常说的容器层，容器之下的都叫做镜像层</p>
<p><img src="/2022/10/17/Docker/2020081215123458.png" alt="在这里插入图片描述"></p>
<ul>
<li><strong>commit镜像</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker commit 提交容器成为一个新的副本</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 命令和git 原理类似</span></span><br><span class="line">docker commit -m=<span class="string">&quot;提交的描述信息&quot;</span> -a=<span class="string">&quot;作者&quot;</span> 容器<span class="built_in">id</span> 目标镜像名：[版本TAG]</span><br><span class="line"> </span><br><span class="line">docker commit -a=<span class="string">&quot;xiaofan&quot;</span> -m=<span class="string">&quot;add webapps app&quot;</span> d798a5946c1f tomcat007:1.0</span><br></pre></td></tr></table></figure>

<p><strong>实战测试</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 启动一个默认的tomcat</span></span><br><span class="line">docker run -d -p 8080:8080 tomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 发现这个默认的tomcat是没有webapps应用， 镜像的原因，官方镜像默认webapps下面是没有内容的</span></span><br><span class="line"><span class="comment">#docker exec -it 容器id /bin/bash</span></span><br><span class="line">docker <span class="built_in">exec</span> -it de57d0ace571 /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 从webapps.dist拷贝文件进去webapp</span></span><br><span class="line"><span class="built_in">cp</span> -r webapps.dist/* webapps</span><br><span class="line"><span class="built_in">cd</span> webapps</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 将操作过的容器通过commit**为一个镜像！我们以后就使用我们修改过的镜像即可，而不需要每次都重新拷贝webapps.dist下的</span></span><br><span class="line"><span class="comment">#    文件到webapps了，这就是我们自己的一个修改的镜像。</span></span><br><span class="line">docker commit -m=<span class="string">&quot;描述信息&quot;</span> -a=<span class="string">&quot;作者&quot;</span> 容器<span class="built_in">id</span> 目标镜像名:[TAG]</span><br><span class="line">docker commit -a=<span class="string">&quot;kuangshen&quot;</span> -m=<span class="string">&quot;add webapps app&quot;</span> 容器<span class="built_in">id</span> tomcat02:1.0</span><br><span class="line">docker commit -a=<span class="string">&quot;csp提交的&quot;</span> -m=<span class="string">&quot;add webapps app&quot;</span> de57d0ace571 tomcat02.1.0</span><br></pre></td></tr></table></figure>

<p><strong>如果你想要保存当前容器的状态，就可以通过commit来提交，获得一个镜像，就好比我们使用虚拟机的快照。</strong></p>
<h1 id="五、容器数据卷"><a href="#五、容器数据卷" class="headerlink" title="五、容器数据卷"></a>五、容器数据卷</h1><h2 id="1-容器数据卷"><a href="#1-容器数据卷" class="headerlink" title="1.容器数据卷"></a>1.容器数据卷</h2><h3 id="1-1-docker-的理解回顾"><a href="#1-1-docker-的理解回顾" class="headerlink" title="1.1.docker 的理解回顾"></a>1.1.docker 的理解回顾</h3><p><strong>什么是数据容器卷</strong></p>
<p>将应用和环境打包成一个镜像！</p>
<p>数据？如果数据都在容器中，那么我们删除容器，数据就会丢失！<strong>需求：数据可以持久化</strong></p>
<p>MySQL，容器删除了，删库跑路！<strong>需求：MySQL数据可以存储在本地!</strong></p>
<p>容器之间可以有一个数据共享技术！Docker 容器中产生的数据，同步到本地！</p>
<p>这就是卷技术，目录的挂载，将我们容器内的目录挂载到 Linux 目录上面！</p>
<p><img src="/2022/10/17/Docker/174493-20210829103321601-907042988.png" alt="img"></p>
<p><strong>总结一句话：容器的持久化和同步操作！容器间也可以数据共享的！</strong></p>
<h3 id="1-2-使用数据卷"><a href="#1-2-使用数据卷" class="headerlink" title="1.2.使用数据卷"></a>1.2.使用数据卷</h3><blockquote>
<p>方式一：直接使用命令来挂载 -v</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-v, --volume list Bind mount a volume</span></span><br><span class="line">docker run -it -v 主机目录:容器内目录 -p 主机端口:容器内端口</span><br><span class="line"></span><br><span class="line"><span class="comment"># /home/ceshi：主机home目录下的ceshi文件夹 映射：centos容器中的/home</span></span><br><span class="line">[root@iz2zeak7 home]<span class="comment"># docker run -it -v /home/ceshi:/home centos /bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#这时候主机的/home/ceshi文件夹就和容器的/home文件夹关联了,二者可以实现文件或数据同步了</span></span><br><span class="line"><span class="comment">#通过 docker inspect 容器id 查看</span></span><br><span class="line">[root@iz2zeak7sgj6i7hrb2g862z home]<span class="comment"># docker inspect 6064c490c371</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-166596988340264.png" alt="在这里插入图片描述"></p>
<p><strong>测试文件的同步</strong>（在主机上改动，观察容器变化）</p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-166596989604867.png" alt="在这里插入图片描述"></p>
<p><strong>再来测试</strong>（测试通过）</p>
<ol>
<li>停止容器</li>
<li>主机上修改文件</li>
<li>启动容器</li>
</ol>
<p><img src="/2022/10/17/Docker/174493-20210829104023001-1484318075.png" alt="img"></p>
<ol start="4">
<li>容器内的数据依旧是同步的！</li>
</ol>
<p><strong>好处：我们以后修改只需要在本地修改即可，容器内会自动同步！</strong></p>
<h3 id="1-3-实战：安装-MySQL"><a href="#1-3-实战：安装-MySQL" class="headerlink" title="1.3.实战：安装 MySQL"></a>1.3.实战：安装 MySQL</h3><p>思考：MySQL 的数据持久化问题！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取镜像</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ home]<span class="comment"># docker pull mysql:5.7</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 运行容器， 需要做数据挂载！ # 安装启动mysql，需要配置密码（注意）</span></span><br><span class="line"><span class="comment"># 参考官网hub</span></span><br><span class="line">docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 启动我们的</span></span><br><span class="line">-d      <span class="comment"># 后台运行</span></span><br><span class="line">-p      <span class="comment"># 端口隐射</span></span><br><span class="line">-v      <span class="comment"># 卷挂载</span></span><br><span class="line">-e      <span class="comment"># 环境配置</span></span><br><span class="line">--name  <span class="comment"># 容器的名字</span></span><br><span class="line">[root@i home]<span class="comment"># docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql02 mysql:5.7</span></span><br><span class="line">9552bf4eb2b69a2ccd344b5ba5965da4d97b19f2e1a78626ac1f2f8d276fc2ba</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 启动成功之后，我们在本地使用navicat链接测试一下</span></span><br><span class="line"><span class="comment"># navicat链接到服务器的3310 --- 3310 和 容器的3306映射，这个时候我们就可以连接上mysql喽！</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 在本地测试创建一个数据库，查看下我们的路径是否ok！</span></span><br></pre></td></tr></table></figure>

<p><strong>测试连接：</strong>注意3310端口要在阿里云服务器的安全组中打开，否则无法连接。</p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-166596992384672.png" alt="在这里插入图片描述"></p>
<p>当我们在本地用 Navicat 新建名称为 test 的数据库时，容器也会创建</p>
<p><img src="/2022/10/17/Docker/174493-20210829104735362-1624630660.png" alt="img"></p>
<p>假设我们将包含 mysql 的容器删除时</p>
<p><img src="/2022/10/17/Docker/174493-20210829104820633-1406266446.png" alt="img"></p>
<p>发现，<strong>我们挂载到本地的数据卷依旧没有丢失，这就实现了容器数据持久化功能</strong></p>
<h3 id="1-4-匿名和具名挂载"><a href="#1-4-匿名和具名挂载" class="headerlink" title="1.4.匿名和具名挂载"></a>1.4.匿名和具名挂载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 匿名挂载</span></span><br><span class="line">-v 容器内路径</span><br><span class="line">docker run -d -P --name nginx01 -v /etc/nginx nginx     <span class="comment"># -P 随机指定端口</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 查看所有volume的情况</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker volume ls</span></span><br><span class="line">DRIVER              VOLUME NAME <span class="comment"># 容器内的卷名(匿名卷挂载)</span></span><br><span class="line"><span class="built_in">local</span>               561b81a03506f31d45ada3f9fb7bd8d7c9b5e0f826c877221a17e45d4c80e096</span><br><span class="line"><span class="built_in">local</span>               36083fb6ca083005094cbd49572a0bffeec6daadfbc5ce772909bb00be760882</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 这里发现，这种情况就是匿名挂载，我们在-v 后面只写了容器内的路径，没有写容器外的路径！</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 具名挂载 -P:表示随机映射端口</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx nginx</span></span><br><span class="line">26da1ec7d4994c76e80134d24d82403a254a4e1d84ec65d5f286000105c3da17</span><br><span class="line"></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                   NAMES</span><br><span class="line">26da1ec7d499        nginx               <span class="string">&quot;/docker-entrypoint.…&quot;</span>   3 seconds ago       Up 2 seconds        0.0.0.0:32769-&gt;80/tcp   nginx02</span><br><span class="line">486de1da03cb        nginx               <span class="string">&quot;/docker-entrypoint.…&quot;</span>   3 minutes ago       Up 3 minutes        0.0.0.0:32768-&gt;80/tcp   nginx01</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有的volume(卷)的情况</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker volume ls</span></span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line"><span class="built_in">local</span>               561b81a03506f31d45ada3f9fb7bd8d7c9b5e0f826c877221a17e45d4c80e096</span><br><span class="line"><span class="built_in">local</span>               36083fb6ca083005094cbd49572a0bffeec6daadfbc5ce772909bb00be760882</span><br><span class="line"><span class="built_in">local</span>               juming-nginx <span class="comment">#多了一个名字</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 通过-v 卷名：容器内的路径</span></span><br><span class="line"><span class="comment"># 查看一下这个卷</span></span><br><span class="line"><span class="comment"># docker volume inspect juming-nginx</span></span><br><span class="line"> </span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker volume inspect juming-nginx</span></span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="string">&quot;CreatedAt&quot;</span>: <span class="string">&quot;2020-08-12T18:15:21+08:00&quot;</span>,</span><br><span class="line">      <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">      <span class="string">&quot;Labels&quot;</span>: null,</span><br><span class="line">      <span class="string">&quot;Mountpoint&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/juming-nginx/_data&quot;</span>,<span class="comment">#默认目录</span></span><br><span class="line">      <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;juming-nginx&quot;</span>,</span><br><span class="line">      <span class="string">&quot;Options&quot;</span>: null,</span><br><span class="line">      <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/17/Docker/174493-20210829110331653-10450211.png" alt="img"></p>
<p>所有 Docker 容器内的卷，没有指定目录的情况下都是在**&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;自定义的卷名&#x2F;_data下，</p>
<p><strong>如果指定了目录，docker volume ls 是查看不到的</strong></p>
<p><img src="/2022/10/17/Docker/174493-20210829110435540-22568902.png" alt="img"></p>
<p>我们通过具名挂载可以方便的找到我们的一个卷，大多数情况下使用的是具名挂载</p>
<p><strong>区分三种挂载方式</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 三种挂载： 匿名挂载、具名挂载、指定路径挂载</span></span><br><span class="line">-v 容器内路径               <span class="comment">#匿名挂载</span></span><br><span class="line">-v 卷名：容器内路径         <span class="comment">#具名挂载</span></span><br><span class="line">-v /宿主机路径：容器内路径  <span class="comment">#指定路径挂载 docker volume ls 是查看不到的</span></span><br></pre></td></tr></table></figure>

<p>拓展</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过 -v 容器内容路径 ro rw 改变读写权限</span></span><br><span class="line">ro  <span class="built_in">readonly</span>    <span class="comment"># 只读</span></span><br><span class="line">rw  readwrite   <span class="comment"># 可读可写</span></span><br><span class="line"> </span><br><span class="line">docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx:ro nginx</span><br><span class="line">docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx:rw nginx</span><br><span class="line"> </span><br><span class="line"><span class="comment"># ro 只要看到ro就说明这个路径只能通过宿主机来操作，容器内容无法操作</span></span><br></pre></td></tr></table></figure>

<h1 id="六、Dockerfile"><a href="#六、Dockerfile" class="headerlink" title="六、Dockerfile"></a>六、Dockerfile</h1><h2 id="初始-Dockerfile"><a href="#初始-Dockerfile" class="headerlink" title="初始 Dockerfile"></a>初始 Dockerfile</h2><p>Dockerfile 就是用来构建docker镜像的构建文件！命令脚本！先体验一下！</p>
<p>通过这个脚本可以生成镜像，镜像是一层一层的，脚本是一个个的命令，每个命令都是一层！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个dockerfile文件，名字可以随便 建议Dockerfile</span></span><br><span class="line"><span class="comment"># 文件中的内容： 指令(大写) + 参数</span></span><br><span class="line">$ vim dockerfile1</span><br><span class="line">FROM centos <span class="comment"># 当前这个镜像是以centos为基础的</span></span><br><span class="line">VOLUME [<span class="string">&quot;volume01&quot;</span>,<span class="string">&quot;volume02&quot;</span>] <span class="comment"># 挂载卷的卷目录列表(多个目录)</span></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="string">&quot;-----end-----&quot;</span> <span class="comment"># 输出一下用于测试</span></span><br><span class="line">CMD /bin/bash <span class="comment"># 默认走bash控制台</span></span><br><span class="line"><span class="comment"># 这里的每个命令，就是镜像的一层！</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建出这个镜像</span></span><br><span class="line">-f dockerfile1 <span class="comment"># f代表file，指这个当前文件的地址(这里是当前目录下的dockerfile1)</span></span><br><span class="line">-t caoshipeng/centos <span class="comment"># t就代表target，指目标目录(注意caoshipeng镜像名前不能加斜杠‘/’)</span></span><br><span class="line">. <span class="comment"># 表示生成在当前目录下</span></span><br><span class="line"></span><br><span class="line">$ docker build -f dockerfile1 -t caoshipeng/centos .</span><br><span class="line">Sending build context to Docker daemon 2.56kB</span><br><span class="line">Step 1/4 : FROM centos</span><br><span class="line">latest: Pulling from library/centos</span><br><span class="line">8a29a15cefae: Already exists</span><br><span class="line">Digest: sha256:fe8d824220415eed5477b63addf40fb06c3b049404242b31982106ac204f6700</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> centos:latest</span><br><span class="line">---&gt; 470671670cac</span><br><span class="line">Step 2/4 : VOLUME [<span class="string">&quot;volume01&quot;</span>,<span class="string">&quot;volume02&quot;</span>] <span class="comment"># 卷名列表</span></span><br><span class="line">---&gt; Running <span class="keyword">in</span> c18eefc2c233</span><br><span class="line">Removing intermediate container c18eefc2c233</span><br><span class="line">---&gt; 623ae1d40fb8</span><br><span class="line">Step 3/4 : CMD <span class="built_in">echo</span> <span class="string">&quot;-----end-----&quot;</span> <span class="comment"># 输出 脚本命令</span></span><br><span class="line">---&gt; Running <span class="keyword">in</span> 70e403669f3c</span><br><span class="line">Removing intermediate container 70e403669f3c</span><br><span class="line">---&gt; 0eba1989c4e6</span><br><span class="line">Step 4/4 : CMD /bin/bash</span><br><span class="line">---&gt; Running <span class="keyword">in</span> 4342feb3a05b</span><br><span class="line">Removing intermediate container 4342feb3a05b</span><br><span class="line">---&gt; f4a6b0d4d948</span><br><span class="line">Successfully built f4a6b0d4d948</span><br><span class="line">Successfully tagged caoshipeng/centos:latest</span><br><span class="line"><span class="comment"># 查看自己构建的镜像</span></span><br><span class="line">$ docker images</span><br><span class="line">REPOSITORY TAG IMAGE ID CREATED SIZE</span><br><span class="line">caoshipeng/centos latest f4a6b0d4d948 About a minute ago 237MB</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-166596999699283.png" alt="在这里插入图片描述"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动自己写的容器镜像</span></span><br><span class="line"></span><br><span class="line">$ docker run -it f4a6b0d4d948 /bin/bash <span class="comment"># 运行自己写的镜像</span></span><br><span class="line">$ <span class="built_in">ls</span> -l <span class="comment"># 查看目录</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-166597000950986.png" alt="在这里插入图片描述"></p>
<p>这个卷和外部一定有一个同步的目录！</p>
<p><img src="/2022/10/17/Docker/20200813103318110.png" alt="在这里插入图片描述"></p>
<p>查看一个卷挂载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker inspect 容器id</span></span><br><span class="line">$ docker inspect ca3b45913df5</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/17/Docker/174493-20210829112920272-639185116.png" alt="在这里插入图片描述"></p>
<p>测试一下刚才的文件是否同步到主机上了！</p>
<p><img src="/2022/10/17/Docker/174493-20210829113026967-653523875.png" alt="img"></p>
<p>这种方式我们未来使用的十分多，因为我们通常会构建自己的镜像！</p>
<p>假设构建镜像时候没有挂载卷，要手动镜像挂载 -v 卷名：容器内路径！</p>
<h2 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h2><p>多个 mysql 同步数据</p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-166597006026495.png" alt="在这里插入图片描述"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试 启动3个容器，通过刚才自己写的镜像启动</span></span><br><span class="line"><span class="comment"># 创建docker01：因为我本机是最新版，故这里用latest，狂神老师用的是1.0如下图</span></span><br><span class="line">$ docker run -it --name docker01 caoshipeng/centos:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看容器docekr01内容</span></span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">bin home lost+found opt run sys var</span><br><span class="line">dev lib media proc sbin tmp volume01</span><br><span class="line">etc lib64 mnt root srv usr volume02</span><br><span class="line"><span class="comment"># 不关闭该容器退出</span></span><br><span class="line">CTRL + Q + P</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建docker02: 并且让docker02 继承 docker01</span></span><br><span class="line">$ docker run -it --name docker02 --volumes-from docker01 caoshipeng/centos:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看容器docker02内容</span></span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">bin home lost+found opt run sys var</span><br><span class="line">dev lib media proc sbin tmp volume01</span><br><span class="line">etc lib64 mnt root srv usr volume02</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/17/Docker/174493-20210829113330954-107909587.png" alt="在这里插入图片描述"></p>
<p><img src="/2022/10/17/Docker/174493-20210829113432325-206094126.png" alt="img"></p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665970092407102.png" alt="在这里插入图片描述"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 再新建一个docker03同样继承docker01</span></span><br><span class="line">$ docker run -it --name docker03 --volumes-from docker01 caoshipeng/centos:latest</span><br><span class="line">$ <span class="built_in">cd</span> volume01 <span class="comment">#进入volume01 查看是否也同步docker01的数据</span></span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">docker01.txt</span><br><span class="line"><span class="comment"># 测试：可以删除docker01，查看一下docker02和docker03是否可以访问这个文件</span></span><br><span class="line"><span class="comment"># 测试发现：数据依旧保留在docker02和docker03中没有被删除</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/17/Docker/174493-20210829113633982-1270662908.png" alt="img"></p>
<p>多个 mysql 实现数据共享</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -p 3306:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line">$ docker run -d -p 3310:3306 -e MYSQL_ROOT_PASSWORD=123456 --name mysql02 --volumes-from mysql01 mysql:5.7</span><br><span class="line"><span class="comment"># 这个时候，可以实现两个容器数据同步！</span></span><br></pre></td></tr></table></figure>

<p><strong>结论</strong></p>
<p>容器之间配置信息的传递，数据卷容器的声明周期一直持续到没用容器使用为止。但是一旦你持久化到了本地，这个时候，本地的数据是不会删除的！</p>
<h2 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h2><p>dockerfile 是用来构建 Docker 镜像的文件！命令参数脚本！</p>
<p>构建步骤：</p>
<ol>
<li>编写一个 dockerfile 文件</li>
<li>docker build 构建成为一个镜像</li>
<li>docker run 运行镜像</li>
<li>docker push 发布镜像 （DockerHub、阿里云镜像）</li>
</ol>
<p>查看官方是怎么做的</p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665970120196107.png" alt="在这里插入图片描述"></p>
<p><strong>点击跳到一个 dockerfile</strong></p>
<p><img src="/2022/10/17/Docker/format,png.png" alt="format_png 14"></p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665970150727112.png" alt="在这里插入图片描述"></p>
<p>很多官方镜像都只是基础包，很多功能不具备，我们通常会搭建自己的镜像！</p>
<p>官方既然可以制作镜像，我们一样可以！</p>
<h2 id="DockerFile-的构建过程"><a href="#DockerFile-的构建过程" class="headerlink" title="DockerFile 的构建过程"></a>DockerFile 的构建过程</h2><p><strong>基础知识：</strong></p>
<ol>
<li>每个保留关键字（指令）必须都是大写字母</li>
<li>执行从上到下的顺序执行</li>
<li>#表示注释</li>
<li>每个指令都会创建提交一个新的镜像层，并提交！</li>
</ol>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665970162340115.png" alt="在这里插入图片描述"></p>
<p>dockerFile 是面向开发的，我们以后要发布项目，做镜像，就需要编写 dockerfile 文件，这个文件十分简单！</p>
<p>Docker 镜像逐渐成为企业的交互标准，必须要掌握！</p>
<p>步骤：开发，部署，运维……缺一不可！</p>
<p>DockerFile：构建文件，定义了一切的步骤，源代码</p>
<p>DockerImages： 通过 DockerFile 构建生成的镜像，最终发布和运行的产品！</p>
<p>Docker 容器：容器就是镜像并运行起来提供服务器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM       <span class="comment"># 基础镜像，一切从这里开始构建</span></span><br><span class="line">MAINTAINER <span class="comment"># 镜像是谁写的， 姓名+邮箱(新版本Docker采用LABEL，不建议使用MAINTAINER，LABEL author=&quot;Socde&lt;stc66@qq.com&gt;&quot;)</span></span><br><span class="line">RUN        <span class="comment"># 镜像构建的时候需要运行的命令</span></span><br><span class="line">ADD        <span class="comment"># 步骤，tomcat镜像，这个tomcat压缩包(自动解压)！添加内容 添加同目录</span></span><br><span class="line">WORKDIR    <span class="comment"># 镜像的工作目录</span></span><br><span class="line">VOLUME     <span class="comment"># 挂载的目录</span></span><br><span class="line">EXPOSE     <span class="comment"># 保留端口配置（多端口直接空格）</span></span><br><span class="line">CMD        <span class="comment"># 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代</span></span><br><span class="line">ENTRYPOINT <span class="comment"># 指定这个容器启动的时候要运行的命令，可以追加命令</span></span><br><span class="line">ONBUILD    <span class="comment"># 当构建一个被继承DockerFile这个时候就会运行onbuild的指令，触发指令</span></span><br><span class="line">COPY       <span class="comment"># 类似ADD，将我们文件拷贝到镜像中</span></span><br><span class="line">ENV        <span class="comment"># 构建的时候设置环境变量！</span></span><br></pre></td></tr></table></figure>

<h2 id="DockerFile-指令说明"><a href="#DockerFile-指令说明" class="headerlink" title="DockerFile 指令说明"></a>DockerFile 指令说明</h2><p><img src="/2022/10/17/Docker/174493-20210829114953496-1607461058.png" alt="在这里插入图片描述"></p>
<p><strong>实战测试</strong></p>
<p>scratch 镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FROM scratch</span><br><span class="line">ADD centos-7-x86_64-docker.tar.xz /</span><br><span class="line">LABEL \</span><br><span class="line">org.label-schema.schema-version=<span class="string">&quot;1.0&quot;</span> \</span><br><span class="line">org.label-schema.name=<span class="string">&quot;CentOS Base Image&quot;</span> \</span><br><span class="line">org.label-schema.vendor=<span class="string">&quot;CentOS&quot;</span> \</span><br><span class="line">org.label-schema.license=<span class="string">&quot;GPLv2&quot;</span> \</span><br><span class="line">org.label-schema.build-date=<span class="string">&quot;20200504&quot;</span> \</span><br><span class="line">org.opencontainers.image.title=<span class="string">&quot;CentOS Base Image&quot;</span> \</span><br><span class="line">org.opencontainers.image.vendor=<span class="string">&quot;CentOS&quot;</span> \</span><br><span class="line">org.opencontainers.image.licenses=<span class="string">&quot;GPL-2.0-only&quot;</span> \</span><br><span class="line">org.opencontainers.image.created=<span class="string">&quot;2020-05-04 00:00:00+01:00&quot;</span></span><br><span class="line">CMD [<span class="string">&quot;/bin/bash&quot;</span>]</span><br></pre></td></tr></table></figure>

<p><strong>Docker Hub 中 99%的镜像都是从这个基础镜像过来的 FROM scratch</strong>，然后配置需要的软件和配置来进行构建。</p>
<p><img src="/2022/10/17/Docker/174493-20210829115650331-859206602.png" alt="img"></p>
<p><strong>创建一个自己的CentOS</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1./home下新建dockerfile目录</span></span><br><span class="line">$ <span class="built_in">mkdir</span> dockerfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. dockerfile目录下新建mydockerfile-centos文件</span></span><br><span class="line">$ vim mydockerfile-centos</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.编写Dockerfile配置文件</span></span><br><span class="line">FROM centos                       <span class="comment"># 基础镜像是官方原生的centos</span></span><br><span class="line">MAINTAINER cao&lt;196655494@qq.com&gt;  <span class="comment"># 作者</span></span><br><span class="line">ENV MYPATH /usr/local             <span class="comment"># 配置环境变量的目录</span></span><br><span class="line">WORKDIR <span class="variable">$MYPATH</span>                   <span class="comment"># 将工作目录设置为 MYPATH</span></span><br><span class="line">RUN yum -y install vim            <span class="comment"># 给官方原生的centos 增加 vim指令</span></span><br><span class="line">RUN yum -y install net-tools      <span class="comment"># 给官方原生的centos 增加 ifconfig命令</span></span><br><span class="line">EXPOSE 80                         <span class="comment"># 暴露端口号为80</span></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="variable">$MYPATH</span>                  <span class="comment"># 输出下 MYPATH 路径</span></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="string">&quot;-----end----&quot;</span></span><br><span class="line">CMD /bin/bash                     <span class="comment"># 启动后进入 /bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.通过这个文件构建镜像</span></span><br><span class="line"><span class="comment"># 命令： docker build -f 文件路径 -t 镜像名:[tag] .</span></span><br><span class="line">$ docker build -f mydockerfile-centos -t mycentos:0.1 .</span><br><span class="line"><span class="comment"># 5.出现下图后则构建成功</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/17/Docker/174493-20210829120127624-1635138712.png" alt="img"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ docker images</span><br><span class="line">REPOSITORY TAG IMAGE ID CREATED SIZE</span><br><span class="line">mycentos 0.1 cbf5110a646d 2 minutes ago 311MB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.测试运行</span></span><br><span class="line">$ docker run -it mycentos:0.1 <span class="comment"># 注意带上版本号，否则每次都回去找最新版latest</span></span><br><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/usr/local <span class="comment"># 与Dockerfile文件中 WORKDIR 设置的 MYPATH 一致</span></span><br><span class="line">$ vim <span class="comment"># vim 指令可以使用</span></span><br><span class="line">$ ifconfig <span class="comment"># ifconfig 指令可以使用</span></span><br><span class="line"><span class="comment"># docker history 镜像id 查看镜像构建历史步骤</span></span><br><span class="line">$ docker <span class="built_in">history</span> 镜像<span class="built_in">id</span></span><br><span class="line"><span class="comment"># 如果要让CREATED BY 列完整显示，可以加上 --no-trunc 参数。直接在shell中看会比较乱，可以输出到文件查看，就比较直观了</span></span><br><span class="line">$ docker <span class="built_in">history</span> --no-trunc 镜像:tag</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/17/Docker/174493-20210829120711644-56780743.png" alt="img"></p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665970228246126.png" alt="在这里插入图片描述"></p>
<p>我们可以列出本地进行的变更历史</p>
<p><img src="/2022/10/17/Docker/174493-20210829120838873-206768548.png" alt="在这里插入图片描述"></p>
<p><strong>我们平时拿到一个镜像，可以用 “docker history 镜像id” 研究一下是什么做的</strong></p>
<blockquote>
<p>CMD 和 ENTRYPOINT 区别</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CMD        <span class="comment"># 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代。</span></span><br><span class="line">ENTRYPOINT <span class="comment"># 指定这个容器启动的时候要运行的命令，可以追加命令</span></span><br></pre></td></tr></table></figure>

<p>测试CMD</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、编写dockerfile文件</span></span><br><span class="line">$ vim dockerfile-test-cmd</span><br><span class="line">FROM centos</span><br><span class="line">CMD [<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;-a&quot;</span>]           <span class="comment"># 启动后执行 ls -a 命令</span></span><br><span class="line"><span class="comment"># 2、构建镜像</span></span><br><span class="line">$ docker build -f dockerfile-test-cmd -t cmd-test:0.1 .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、运行镜像，发现我们的ls -a 命令生效</span></span><br><span class="line">$ docker run cmd-test:0.1 <span class="comment"># 由结果可得，运行后就执行了 ls -a 命令</span></span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line"><span class="comment"># 想追加一个命令 -l 成为ls -al：展示列表详细数据</span></span><br><span class="line">$ docker run cmd-test:0.1 -l</span><br><span class="line">docker: Error response from daemon: OCI runtime create failed: container_linux.go:349: starting container process caused <span class="string">&quot;exec: \&quot;-l\&quot;:</span></span><br><span class="line"><span class="string">executable file not found in <span class="variable">$PATH</span>&quot;</span>: unknown.</span><br><span class="line">ERRO[0000] error waiting <span class="keyword">for</span> container: context canceled</span><br><span class="line"><span class="comment"># cmd的情况下 -l 替换了CMD[&quot;ls&quot;,&quot;-l&quot;] 而 -l 不是命令所以报错</span></span><br></pre></td></tr></table></figure>

<p>测试ENTRYPOINT</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、编写dockerfile文件</span></span><br><span class="line">$ vim dockerfile-test-entrypoint</span><br><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT [<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;-a&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、构建镜像</span></span><br><span class="line">$ docker build -f dockerfile-test-entrypoint -t cmd-test:0.1 .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、运行镜像，现我们的ls -a 命令同样生效</span></span><br><span class="line">$ docker run entrypoint-test:0.1</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、我们的追加命令，是直接拼接在我们的ENTRYPOINT命令后面的</span></span><br><span class="line">$ docker run entrypoint-test:0.1 -l</span><br><span class="line">total 56</span><br><span class="line">drwxr-xr-x 1 root root 4096 May 16 06:32 .</span><br><span class="line">drwxr-xr-x 1 root root 4096 May 16 06:32 ..</span><br><span class="line">-rwxr-xr-x 1 root root 0 May 16 06:32 .dockerenv</span><br><span class="line">lrwxrwxrwx 1 root root 7 May 11 2019 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x 5 root root 340 May 16 06:32 dev</span><br><span class="line">drwxr-xr-x 1 root root 4096 May 16 06:32 etc</span><br><span class="line">drwxr-xr-x 2 root root 4096 May 11 2019 home</span><br><span class="line">lrwxrwxrwx 1 root root 7 May 11 2019 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx 1 root root 9 May 11 2019 lib64 -&gt; usr/lib64 ....</span><br></pre></td></tr></table></figure>

<p>Dockerfile中很多命令都十分的相似，我们需要了解它们的区别，我们最好的学习就是对比他们然后测试效果！</p>
<h1 id="七、DockerFile-制作-tomcat-镜像"><a href="#七、DockerFile-制作-tomcat-镜像" class="headerlink" title="七、DockerFile 制作 tomcat 镜像"></a>七、DockerFile 制作 tomcat 镜像</h1><h2 id="DockerFile-制作-tomcat-镜像"><a href="#DockerFile-制作-tomcat-镜像" class="headerlink" title="DockerFile 制作 tomcat 镜像"></a>DockerFile 制作 tomcat 镜像</h2><ol>
<li>准备镜像文件 tomcat 文件压缩包，jdk 的压缩包到当前目录，编写好README!</li>
</ol>
<p><img src="/2022/10/17/Docker/174493-20210829122157692-50538984.png" alt="在这里插入图片描述"></p>
<ol start="2">
<li>编写 Dockerfile 文件，官方命名 Dockerfile，build 会自动寻找这个文件，就不需要 -f 指定了！</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ vim dockerfile</span><br><span class="line">FROM centos                                 <span class="comment"># 基础镜像centos</span></span><br><span class="line">MAINTAINER cao&lt;1165680007@qq.com&gt;           <span class="comment"># 作者</span></span><br><span class="line">COPY README /usr/local/README               <span class="comment"># 复制README文件</span></span><br><span class="line">ADD jdk-8u231-linux-x64.tar.gz /usr/local/  <span class="comment"># 添加jdk，ADD 命令会自动解压</span></span><br><span class="line">ADD apache-tomcat-9.0.35.tar.gz /usr/local/ <span class="comment"># 添加tomcat，ADD 命令会自动解压</span></span><br><span class="line">RUN yum -y install vim                      <span class="comment"># 安装 vim 命令</span></span><br><span class="line">ENV MYPATH /usr/local                       <span class="comment"># 环境变量设置 工作目录(设置完工作目录后，所有文件添加在此，ADD文件路径及其它可以使用相对路径./)</span></span><br><span class="line">WORKDIR <span class="variable">$MYPATH</span></span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_231       <span class="comment"># 环境变量： JAVA_HOME环境变量</span></span><br><span class="line">ENV CLASSPATH <span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.35  <span class="comment"># 环境变量： tomcat环境变量</span></span><br><span class="line">ENV CATALINA_BASH /usr/local/apache-tomcat-9.0.35</span><br><span class="line"><span class="comment"># 设置环境变量 分隔符是：</span></span><br><span class="line">ENV PATH <span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$CATALINA_HOME</span>/lib:<span class="variable">$CATALINA_HOME</span>/bin</span><br><span class="line">EXPOSE 8080 <span class="comment"># 设置暴露的端口</span></span><br><span class="line">CMD /usr/local/apache-tomcat-9.0.35/bin/startup.sh &amp;&amp; <span class="built_in">tail</span> -F /usr/local/apache-tomcat-9.0.35/logs/catalina.out <span class="comment"># 设置默认命令</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>构建镜像</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 因为dockerfile命名使用默认命名 因此不用使用-f 指定文件</span></span><br><span class="line">$ docker build -t mytomcat:0.1 .</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>启动镜像</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -d:后台运行 -p:暴露端口 --name:别名 -v:绑定路径</span></span><br><span class="line">$ docker run -d -p 8080:8080 --name tomcat01</span><br><span class="line">-v /home/kuangshen/build/tomcat/test:/usr/local/apache-tomcat-9.0.35/webapps/test</span><br><span class="line">-v /home/kuangshen/build/tomcat/tomcatlogs/:/usr/local/apache-tomcat-9.0.35/logs mytomcat:0.1</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>访问测试</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it 自定义容器的<span class="built_in">id</span> /bin/bash</span><br><span class="line">$ cul localhost:8080</span><br></pre></td></tr></table></figure>

<ol start="6">
<li><p>发布项目（由于做了卷挂载，直接在本地编写项目就可以发布了）</p>
<p><strong>在本地编写web.xml和index.jsp进行测试</strong></p>
</li>
</ol>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665970597628133.png" alt="在这里插入图片描述"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">version</span>=<span class="string">&quot;2.4&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/j2ee&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/j2ee </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;hello. xiaofan&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">Hello World!&lt;br/&gt;</span><br><span class="line">&lt;%</span><br><span class="line">System.out.println(<span class="string">&quot;-----my test web logs------&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>发现：项目部署成功，可以直接访问 ok！</p>
<p>我们以后开发的步骤：需要掌握 Dockerfile 的编写！我们之后的一切都是使用 docker 来进行发布运行的！</p>
<p><img src="/2022/10/17/Docker/20200813175909845.png" alt="在这里插入图片描述"></p>
<h2 id="发布自己的镜像到-Docker-Hub"><a href="#发布自己的镜像到-Docker-Hub" class="headerlink" title="发布自己的镜像到 Docker Hub"></a>发布自己的镜像到 Docker Hub</h2><blockquote>
<p>Docker Hub</p>
</blockquote>
<ol>
<li>地址<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a> 注册自己的账号</li>
</ol>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665970895044138.png" alt="在这里插入图片描述"></p>
<ol start="2">
<li>确定这个账号可以登录</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ docker login --<span class="built_in">help</span></span><br><span class="line">Usage: docker login [OPTIONS] [SERVER]</span><br><span class="line">Log <span class="keyword">in</span> to a Docker registry.</span><br><span class="line">If no server is specified, the default is defined by the daemon.</span><br><span class="line">Options:</span><br><span class="line">-p, --password string Password</span><br><span class="line">--password-stdin Take the password from stdin</span><br><span class="line">-u, --username string Username</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录</span></span><br><span class="line">$ docker login -u 你的用户名 -p 你的密码</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665970934442141.png" alt="在这里插入图片描述"></p>
<ol start="3">
<li>提交 push 镜像</li>
</ol>
<p><img src="/2022/10/17/Docker/174493-20210829124325700-1791106991.png" alt="img"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker push diytomcat</span></span><br><span class="line">The push refers to repository [docker.io/library/diytomcat]</span><br><span class="line">2eaca873a720: Preparing </span><br><span class="line">1b38cc4085a8: Preparing </span><br><span class="line">088ebb58d264: Preparing </span><br><span class="line">c06785a2723d: Preparing </span><br><span class="line">291f6e44771a: Preparing </span><br><span class="line">denied: requested access to the resource is denied  <span class="comment"># 拒绝</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># push镜像的问题？</span></span><br><span class="line">The push refers to repository [docker.io/1314520007/diytomcat]</span><br><span class="line">An image does not exist locally with the tag: 1314520007/diytomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 会发现push不上去，因为如果没有前缀的话默认是push到 官方的library</span></span><br><span class="line"><span class="comment"># 解决方法：</span></span><br><span class="line"><span class="comment"># 第一种 build的时候添加你的dockerhub用户名，然后在push就可以放到自己的仓库了</span></span><br><span class="line">$ docker build -t kuangshen/mytomcat:0.1 .</span><br><span class="line"><span class="comment"># 第二种 使用docker tag #然后再次push</span></span><br><span class="line">$ docker tag 容器<span class="built_in">id</span> kuangshen/mytomcat:1.0 <span class="comment">#然后再次push</span></span><br><span class="line">$ docker push kuangshen/mytomcat:1.0</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665970993822146.png" alt="在这里插入图片描述"></p>
<h2 id="发布镜像到阿里云镜像服务上"><a href="#发布镜像到阿里云镜像服务上" class="headerlink" title="发布镜像到阿里云镜像服务上"></a>发布镜像到阿里云镜像服务上</h2><ol>
<li>登录阿里云</li>
<li>找到容器镜像服务</li>
<li>创建命名空间</li>
</ol>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665971070631149.png" alt="在这里插入图片描述"></p>
<ol start="4">
<li>创建容器镜像</li>
</ol>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665971135250152.png" alt="在这里插入图片描述"></p>
<ol start="5">
<li>点击仓库名称，参考官方文档即可</li>
</ol>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665971188651155.png" alt="在这里插入图片描述"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665971227370158.png" alt="在这里插入图片描述"></p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665971239545161.png" alt="在这里插入图片描述"></p>
<h1 id="八、Docker-网络"><a href="#八、Docker-网络" class="headerlink" title="八、Docker 网络"></a>八、Docker 网络</h1><h2 id="1-Docker-网络"><a href="#1-Docker-网络" class="headerlink" title="1.Docker 网络"></a>1.Docker 网络</h2><h3 id="链接-Docker0"><a href="#链接-Docker0" class="headerlink" title="链接 Docker0"></a>链接 Docker0</h3><p>学习之前<strong>清空下面的 docker 镜像、容器</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除全部容器</span></span><br><span class="line">$ docker <span class="built_in">rm</span> -f $(docker ps -aq)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除全部镜像</span></span><br><span class="line">$ docker rmi -f $(docker images -aq)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>测试</p>
</blockquote>
<p><img src="/2022/10/17/Docker/174493-20210829135203572-748583549.png" alt="在这里插入图片描述"></p>
<p>三个网络</p>
<p><strong>问题：</strong> docker 是如何处理容器网络访问的？</p>
<p><img src="/2022/10/17/Docker/174493-20210829135252397-1084027368.png" alt="img"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试 运行一个tomcat</span></span><br><span class="line">$ docker run -d -P --name tomcat01 tomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看容器内部网络地址</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it 容器<span class="built_in">id</span> ip addr</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发现容器启动的时候会得到一个 eth0@if91 ip地址，docker分配！</span></span><br><span class="line">$ ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1</span><br><span class="line"><span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">inet 127.0.0.1/8 scope host lo</span><br><span class="line">valid_lft forever preferred_lft forever</span><br><span class="line">261: eth0@if91: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line"><span class="built_in">link</span>/ether 02:42:ac:12:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">inet 172.18.0.2/16 brd 172.18.255.255 scope global eth0</span><br><span class="line">valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="comment"># 思考？ linux能不能ping通容器内部！可以，容器内部可以ping通外界吗？可以！</span></span><br><span class="line">$ ping 172.18.0.2</span><br><span class="line">PING 172.18.0.2 (172.18.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.18.0.2: icmp_seq=1 ttl=64 time=0.069 ms</span><br><span class="line">64 bytes from 172.18.0.2: icmp_seq=2 ttl=64 time=0.074 ms</span><br></pre></td></tr></table></figure>

<blockquote>
<p>原理</p>
</blockquote>
<p>1、我们每启动一个 docker 容器，docker 就会给 docker 容器分配一个ip，我们只要安装了 docker，就会有一个网卡 docker0 桥接模式，使用的技术是 veth-pai 技术！</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/bakari/p/10613710.html">https://www.cnblogs.com/bakari/p/10613710.html</a></p>
<p>再次测试 ip addr</p>
<p><img src="/2022/10/17/Docker/174493-20210829135837747-858853724.png" alt="在这里插入图片描述"></p>
<p>2、再启动一个容器测试，发现又多了一对网卡</p>
<p><img src="/2022/10/17/Docker/174493-20210829135938223-1830130159.png" alt="在这里插入图片描述"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 我们发现这个容器带来网卡，都是一对对的</span></span><br><span class="line"><span class="comment"># veth-pair 就是一对的虚拟设备接口，他们都是成对出现的，一端连着协议，一端彼此相连</span></span><br><span class="line"><span class="comment"># 正因为有这个特性 veth-pair 充当一个桥梁，连接各种虚拟网络设备的</span></span><br><span class="line"><span class="comment"># OpenStac,Docker容器之间的连接，OVS的连接，都是使用evth-pair技术</span></span><br></pre></td></tr></table></figure>

<p>3、我们测试一下 tomcat01 和 tomcat02 之间是否可以 ping 通！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取tomcat01的ip 172.17.0.2</span></span><br><span class="line">$ docker-tomcat docker <span class="built_in">exec</span> -it tomcat01 ip addr</span><br><span class="line">550: eth0@if551: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line"><span class="built_in">link</span>/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">valid_lft forever preferred_lft forever</span><br><span class="line"><span class="comment"># 让tomcat02 ping tomcat01</span></span><br><span class="line">$ docker-tomcat docker <span class="built_in">exec</span> -it tomcat02 ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.098 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.071 ms</span><br><span class="line"><span class="comment"># 结论：容器和容器之间是可以互相ping通</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665971757001172.png" alt="在这里插入图片描述"></p>
<p><strong>网络模型图</strong></p>
<p>结论：容器与容器之间是可以相互 ping 通的，绘制一个网络模型图</p>
<p><img src="/2022/10/17/Docker/174493-20210829140321694-1827961572.png" alt="img"></p>
<p>结论：tomcat01 和 tomcat02 是共用的一个路由器，docker0</p>
<p>所有的容器在不指定网络的情况下，都是 docker0 路由的，docker 会给我们的容器分配一个默认的可用的ip</p>
<blockquote>
<p>小结</p>
</blockquote>
<p>Docker 使用的是 Linux 的桥接，宿主机中是一个 Docker 容器的网桥 docker0.</p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665971962894177.png" alt="在这里插入图片描述"></p>
<p>Docker 中的所有的网络接口都是虚拟的，虚拟的转发效率高！（内网传递文件！）</p>
<p>只要容器删除，对应的网桥一对就没了！</p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665972042791180.png" alt="在这里插入图片描述"></p>
<p><strong>– link</strong></p>
<blockquote>
<p>思考一个场景，我们编写了一个微服务，database url &#x3D; ip；项目不重启，数据 ip 换掉了，我们希望可以处理这个问题，可以按名字来访问容器</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it tomcat02 ping tomca01 <span class="comment"># ping不通</span></span><br><span class="line">ping: tomca01: Name or service not known</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如何可以解决呢？</span></span><br><span class="line"><span class="comment"># 通过--link既可以解决网络连通问题</span></span><br><span class="line"><span class="comment"># 运行一个tomcat03 --link tomcat02</span></span><br><span class="line">$ docker run -d -P --name tomcat03 --<span class="built_in">link</span> tomcat02 tomcat</span><br><span class="line">5f9331566980a9e92bc54681caaac14e9fc993f14ad13d98534026c08c0a9aef</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3连接2</span></span><br><span class="line"><span class="comment"># 用tomcat03 ping tomcat02 可以ping通</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it tomcat03 ping tomcat02</span><br><span class="line">PING tomcat02 (172.17.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=1 ttl=64 time=0.115 ms</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=2 ttl=64 time=0.080 ms</span><br><span class="line"></span><br><span class="line"><span class="comment"># 反向可以ping通吗？</span></span><br><span class="line"><span class="comment"># 2连接3</span></span><br><span class="line"><span class="comment"># 用tomcat02 ping tomcat03 ping不通</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker exec -it tomcat02 ping tomcat03</span></span><br><span class="line">ping: tomcat03: Name or service not known</span><br></pre></td></tr></table></figure>

<p>探究：inspect（docker network inspect 网络id 网段相同）</p>
<p><img src="/2022/10/17/Docker/174493-20210829153223298-496395578.png" alt="在这里插入图片描述"></p>
<p><strong>docker inspect tomcat03</strong></p>
<p><img src="/2022/10/17/Docker/174493-20210829153343929-344251577.png" alt="img"></p>
<p>查看 tomcat03 里面的 &#x2F;etc&#x2F;hosts 发现有 tomcat02 的配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker exec -it tomcat03 cat /etc/hosts</span></span><br><span class="line">127.0.0.1   localhost</span><br><span class="line">::1 localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0 ip6-localnet</span><br><span class="line">ff00::0 ip6-mcastprefix</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br><span class="line">172.17.0.3  tomcat02 f22ed47ed1be</span><br><span class="line">172.17.0.4  3a2bcaba804c</span><br></pre></td></tr></table></figure>

<p>本质探究：– link 就是我们在 hosts 配置中增加了一个 172.12.0.3 tomcat02 f22ed47ed1be</p>
<p>我们现在玩 Docker 已经不建议使用 – link 了！</p>
<p>自定义网络！不使用 docker0</p>
<p>docker0 的问题：它不支持容器名链接访问！</p>
<h2 id="2-自定义网络"><a href="#2-自定义网络" class="headerlink" title="2.自定义网络"></a>2.自定义网络</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker network</span><br><span class="line">connect -- Connect a container to a network</span><br><span class="line">create -- Creates a new network with a name specified by the</span><br><span class="line">disconnect -- Disconnects a container from a network</span><br><span class="line">inspect -- Displays detailed information on a network</span><br><span class="line"><span class="built_in">ls</span> -- Lists all the networks created by the user</span><br><span class="line">prune -- Remove all unused networks</span><br><span class="line"><span class="built_in">rm</span> -- Deletes one or more networks</span><br></pre></td></tr></table></figure>

<blockquote>
<p>查看所有的 docker 网络</p>
</blockquote>
<p><img src="/2022/10/17/Docker/20200814105640929.png" alt="在这里插入图片描述"></p>
<p><strong>网络模式</strong></p>
<p>bridge：桥接模式，桥接 docker （默认，自己创建的也是用 bridge 模式）</p>
<p>none：不配置网络，一般不用</p>
<p>host：和宿主机共享网络</p>
<p>container：容器网络连通！（用的少，局限很大）</p>
<p><strong>测试</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 我们直接启动的命令 --net bridge,而这个就是我们得docker0</span></span><br><span class="line"><span class="comment"># bridge就是docker0</span></span><br><span class="line">$ docker run -d -P --name tomcat01 tomcat</span><br><span class="line">等价于 =&gt; docker run -d -P --name tomcat01 --net bridge tomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker0，特点：默认，容器名不能访问。 --link可以打通连接，但是很麻烦！</span></span><br><span class="line"><span class="comment"># 我们可以 自定义一个网络</span></span><br><span class="line"><span class="comment"># --driver bridge</span></span><br><span class="line"><span class="comment"># --subnet 192.168.0.0/16 可以支持255*255个网络 192.168.0.2 ~ 192.168.255.254</span></span><br><span class="line"><span class="comment"># --gateway 192.168.0.1</span></span><br><span class="line">$ docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br><span class="line">26a5afdf4805d7ee0a660b82244929a4226470d99a179355558dca35a2b983ec</span><br><span class="line"></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">30d601788862        bridge              bridge              <span class="built_in">local</span></span><br><span class="line">226019b14d91        host                host                <span class="built_in">local</span></span><br><span class="line">26a5afdf4805        mynet               bridge              <span class="built_in">local</span></span><br><span class="line">7496c014f74b        none                null                <span class="built_in">local</span></span><br></pre></td></tr></table></figure>

<p>我们自己创建的网络就ok了！</p>
<p>$ docker network inspect mynet;</p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665972703738189.png" alt="在这里插入图片描述"></p>
<p>在自己创建的网络里面启动两个 tomcat 容器，再次查看网络情况</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker run -d -P --name tomcat-net-01 --net mynet tomcat</span></span><br><span class="line">0e85ebe6279fd23379d39b27b5f47c1e18f23ba7838637802973bf6449e22f5c</span><br><span class="line"></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker run -d -P --name tomcat-net-02 --net mynet tomcat</span></span><br><span class="line">c6e462809ccdcebb51a4078b1ac8fdec33f1112e9e416406b606d0c9fb6f21b5</span><br><span class="line"></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker network inspect mynet</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;mynet&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;26a5afdf4805d7ee0a660b82244929a4226470d99a179355558dca35a2b983ec&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2020-08-14T11:12:40.553433163+08:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;bridge&quot;</span>,</span><br><span class="line">        <span class="string">&quot;EnableIPv6&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;IPAM&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">&quot;Config&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;Subnet&quot;</span>: <span class="string">&quot;192.168.0.0/16&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;192.168.0.1&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Internal&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Attachable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Ingress&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;ConfigFrom&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;ConfigOnly&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Containers&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;0e85ebe6279fd23379d39b27b5f47c1e18f23ba7838637802973bf6449e22f5c&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;tomcat-net-01&quot;</span>,</span><br><span class="line">                <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;576ce5c0f5860a5aab5e487a805da9d72f41a409c460f983c0bd341dd75d83ac&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:c0:a8:00:02&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;192.168.0.2/16&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;c6e462809ccdcebb51a4078b1ac8fdec33f1112e9e416406b606d0c9fb6f21b5&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;tomcat-net-02&quot;</span>,</span><br><span class="line">                <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;81ecbc4fe26e49855fe374f2d7c00d517b11107cc91a174d383ff6be37d25a30&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:c0:a8:00:03&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;192.168.0.3/16&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 再次拼连接</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker exec -it tomcat-net-01 ping 192.168.0.3</span></span><br><span class="line">PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=1 ttl=64 time=0.113 ms</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=2 ttl=64 time=0.093 ms</span><br><span class="line">^C</span><br><span class="line">--- 192.168.0.3 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 999ms</span><br><span class="line">rtt min/avg/max/mdev = 0.093/0.103/0.113/0.010 ms</span><br><span class="line"></span><br><span class="line"><span class="comment"># 现在不使用 --link也可以ping名字了！</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker exec -it tomcat-net-01 ping tomcat-net-02</span></span><br><span class="line">PING tomcat-net-02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.068 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.096 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=3 ttl=64 time=0.094 ms</span><br></pre></td></tr></table></figure>

<p>我们自定义的网络 docker 都已经帮我们维护好了对应关系，推荐我们平时这样使用网络！</p>
<p>好处:</p>
<ul>
<li>redis - 不同的集群使用不同的网络，保证集群是安全和健康的</li>
<li>mysql - 不同的集群使用不同的网络，保证集群是安全和健康的</li>
</ul>
<p><img src="/2022/10/17/Docker/174493-20210829160039497-192058107.png" alt="img"></p>
<h2 id="3-网络连通"><a href="#3-网络连通" class="headerlink" title="3.网络连通"></a>3.网络连通</h2><p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665972978447194.png" alt="在这里插入图片描述"></p>
<p><img src="/2022/10/17/Docker/174493-20210829160314218-416095380.png" alt="img"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试两个不同的网络连通 再启动两个tomcat 使用默认网络，即docker0</span></span><br><span class="line">$ docker run -d -P --name tomcat01 tomcat</span><br><span class="line">$ docker run -d -P --name tomcat02 tomcat</span><br><span class="line"><span class="comment"># 此时ping不通</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/17/Docker/174493-20210829161244611-1654912751.png" alt="img"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 要将tomcat01 连通 tomcat—net-01 ，连通就是将 tomcat01加到 mynet网络</span></span><br><span class="line"><span class="comment"># 一个容器两个ip（tomcat01）</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/17/Docker/174493-20210829161335934-890595807.png" alt="img"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01连通 ，加入后此时，已经可以tomcat01 和 tomcat-01-net ping通了</span></span><br><span class="line"><span class="comment"># 02是依旧不通的</span></span><br></pre></td></tr></table></figure>

<h2 id="4-测试打通-tomcat01-和-mynet"><a href="#4-测试打通-tomcat01-和-mynet" class="headerlink" title="4.测试打通 tomcat01 和 mynet"></a>4.测试打通 tomcat01 和 mynet</h2><p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665973085290203.png" alt="在这里插入图片描述"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker network connect  mynet tomcat01</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 连通之后就是讲tomcat01 放到了mynet网路下</span></span><br><span class="line"><span class="comment"># 一个容器两个ip地址：</span></span><br><span class="line"><span class="comment"># 阿里云服务器，公网ip，私网ip</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665973107169206.png" alt="在这里插入图片描述"></p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665973114659209.png" alt="在这里插入图片描述"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 连通ok</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker exec -it tomcat01 ping tomcat-net-01</span></span><br><span class="line">PING tomcat-net-01 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.100 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.085 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat-net-01 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 1000ms</span><br><span class="line">rtt min/avg/max/mdev = 0.085/0.092/0.100/0.012 ms</span><br><span class="line"></span><br><span class="line"><span class="comment"># 依旧无法连通，没有connect</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ ~]<span class="comment"># docker exec -it tomcat02 ping tomcat-net-01</span></span><br><span class="line">ping: tomcat-net-01: Name or service not known</span><br></pre></td></tr></table></figure>

<p>结论：假设要跨网络操作别人，就要使用 docker network connect 连通……!</p>
<h2 id="5-实战：部署-redis"><a href="#5-实战：部署-redis" class="headerlink" title="5.实战：部署 redis"></a>5.实战：部署 redis</h2><p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665973344397212.png" alt="在这里插入图片描述"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建网卡</span></span><br><span class="line">docker network create redis --subnet 172.38.0.0/16</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过脚本创建六个redis配置</span></span><br><span class="line"><span class="keyword">for</span> port <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 6);\</span><br><span class="line"><span class="keyword">do</span> \</span><br><span class="line"><span class="built_in">mkdir</span> -p /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/conf</span><br><span class="line"><span class="built_in">touch</span> /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/conf/redis.conf</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt;&gt; /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span></span><br><span class="line"><span class="string">port 6379</span></span><br><span class="line"><span class="string">bind 0.0.0.0</span></span><br><span class="line"><span class="string">cluster-enabled yes</span></span><br><span class="line"><span class="string">cluster-config-file nodes.conf</span></span><br><span class="line"><span class="string">cluster-node-timeout 5000</span></span><br><span class="line"><span class="string">cluster-announce-ip 172.38.0.1$&#123;port&#125;</span></span><br><span class="line"><span class="string">cluster-announce-port 6379</span></span><br><span class="line"><span class="string">cluster-announce-bus-port 16379</span></span><br><span class="line"><span class="string">appendonly yes</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过脚本运行6个redis</span></span><br><span class="line"><span class="keyword">for</span> port <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 6);\</span><br><span class="line">docker run -p 637<span class="variable">$&#123;port&#125;</span>:6379 -p 1667<span class="variable">$&#123;port&#125;</span>:16379 --name redis-<span class="variable">$&#123;port&#125;</span> \</span><br><span class="line">-v /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/data:/data \</span><br><span class="line">-v /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.1<span class="variable">$&#123;port&#125;</span> redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 手动创那家6个redis</span></span><br><span class="line"><span class="comment"># 创建结点1</span></span><br><span class="line">docker run -p 6371:6379 -p 16371:16379 --name redis-1 \</span><br><span class="line">-v /mydata/redis/node-1/data:/data \</span><br><span class="line">-v /mydata/redis/node-1/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.11 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"> </span><br><span class="line"><span class="comment">#创建结点2</span></span><br><span class="line">docker run -p 6372:6379 -p 16372:16379 --name redis-2 \</span><br><span class="line">-v /mydata/redis/node-2/data:/data \</span><br><span class="line">-v /mydata/redis/node-2/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.12 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="comment">#创建结点3</span></span><br><span class="line">docker run -p 6373:6379 -p 16373:16379 --name redis-3 \</span><br><span class="line">-v /mydata/redis/node-3/data:/data \</span><br><span class="line">-v /mydata/redis/node-3/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.13 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="comment">#创建结点4</span></span><br><span class="line">docker run -p 6374:6379 -p 16374:16379 --name redis-4 \</span><br><span class="line">-v /mydata/redis/node-4/data:/data \</span><br><span class="line">-v /mydata/redis/node-4/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.14 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="comment">#创建结点5</span></span><br><span class="line">docker run -p 6375:6379 -p 16375:16379 --name redis-5 \</span><br><span class="line">-v /mydata/redis/node-5/data:/data \</span><br><span class="line">-v /mydata/redis/node-5/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.15 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="comment">#创建结点6</span></span><br><span class="line">docker run -p 6376:6379 -p 16376:16379 --name redis-6 \</span><br><span class="line">-v /mydata/redis/node-6/data:/data \</span><br><span class="line">-v /mydata/redis/node-6/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.16 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建集群</span></span><br><span class="line">docker <span class="built_in">exec</span> -it redis-1 /bin/sh <span class="comment">#redis默认没有bash</span></span><br><span class="line">redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/17/Docker/174493-20210829162857870-1542103403.png" alt="img"></p>
<p>docker 搭建 redis 集群完成！</p>
<p><img src="/2022/10/17/Docker/174493-20210829163101359-175324787.png" alt="img"></p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665973413751219.png" alt="在这里插入图片描述"></p>
<h2 id="6-SpringBoot-微服务打包-Docker-镜像"><a href="#6-SpringBoot-微服务打包-Docker-镜像" class="headerlink" title="6.SpringBoot 微服务打包 Docker 镜像"></a>6.SpringBoot 微服务打包 Docker 镜像</h2><ol>
<li><p>构建springboot项目</p>
</li>
<li><p>打包应用: mvn package</p>
</li>
<li><p>编写 Dockerfile</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM java:8</span><br><span class="line">COPY *.jar /app.jar</span><br><span class="line">CMD [<span class="string">&quot;--server.port=8080&quot;</span>]</span><br><span class="line">EXPOSE 8080</span><br><span class="line">ENTRYPOINT [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;app.jar&quot;</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>构建镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.复制jar和DockerFIle到服务器</span></span><br><span class="line"><span class="comment"># 2.构建镜像</span></span><br><span class="line">$ docker build -t xxxxx:xx .</span><br></pre></td></tr></table></figure>
</li>
<li><p>发布运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ idea]<span class="comment"># ll</span></span><br><span class="line">total 16140</span><br><span class="line">-rw-r--r-- 1 root root 16519871 Aug 14 17:38 demo-0.0.1-SNAPSHOT.jar</span><br><span class="line">-rw-r--r-- 1 root root      122 Aug 14 17:38 Dockerfile</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 构建镜像，不要忘了最后有一个点</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ idea]<span class="comment"># docker build -t xiaofan666 .</span></span><br><span class="line">Sending build context to Docker daemon  16.52MB</span><br><span class="line">Step 1/5 : FROM java:8</span><br><span class="line">8: Pulling from library/java</span><br><span class="line">5040bd298390: Pull complete </span><br><span class="line">fce5728aad85: Pull complete </span><br><span class="line">76610ec20bf5: Pull complete </span><br><span class="line">60170fec2151: Pull complete </span><br><span class="line">e98f73de8f0d: Pull complete </span><br><span class="line">11f7af24ed9c: Pull complete </span><br><span class="line">49e2d6393f32: Pull complete </span><br><span class="line">bb9cdec9c7f3: Pull complete </span><br><span class="line">Digest: sha256:c1ff613e8ba25833d2e1940da0940c3824f03f802c449f3d1815a66b7f8c0e9d</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> java:8</span><br><span class="line"> ---&gt; d23bdf5b1b1b</span><br><span class="line">Step 2/5 : COPY *.jar /app.jar</span><br><span class="line"> ---&gt; d4de8837ebf9</span><br><span class="line">Step 3/5 : CMD [<span class="string">&quot;--server.port=8080&quot;</span>]</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> e3abc66303f0</span><br><span class="line">Removing intermediate container e3abc66303f0</span><br><span class="line"> ---&gt; 131bb3917fea</span><br><span class="line">Step 4/5 : EXPOSE 8080</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> fa2f25977db7</span><br><span class="line">Removing intermediate container fa2f25977db7</span><br><span class="line"> ---&gt; d98147377951</span><br><span class="line">Step 5/5 : ENTRYPOINT [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;/app.jar&quot;</span>]</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> e1885e23773b</span><br><span class="line">Removing intermediate container e1885e23773b</span><br><span class="line"> ---&gt; afb6b5f28a32</span><br><span class="line">Successfully built afb6b5f28a32</span><br><span class="line">Successfully tagged xiaofan666:latest</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 查看镜像</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ idea]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">xiaofan666          latest              afb6b5f28a32        14 seconds ago      660MB</span><br><span class="line">tomcat              latest              2ae23eb477aa        8 days ago          647MB</span><br><span class="line">redis               5.0.9-alpine3.11    3661c84ee9d0        3 months ago        29.8MB</span><br><span class="line">java                8                   d23bdf5b1b1b        3 years ago         643MB</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 运行容器</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ idea]<span class="comment"># docker run -d -P --name xiaofan-springboot-web xiaofan666</span></span><br><span class="line">fd9a353a80bfd61f6930c16cd92204532bfd734e003f3f9983b5128a27b0375e</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看运行起来的容器端口（因为我们启动的时候没有指定）</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ idea]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                     NAMES</span><br><span class="line">fd9a353a80bf        xiaofan666          <span class="string">&quot;java -jar /app.jar …&quot;</span>   9 seconds ago       Up 8 seconds        0.0.0.0:32779-&gt;8080/tcp   xiaofan-springboot-web</span><br><span class="line"></span><br><span class="line"><span class="comment"># 本地访问1</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ idea]<span class="comment"># curl localhost:32779</span></span><br><span class="line">&#123;<span class="string">&quot;timestamp&quot;</span>:<span class="string">&quot;2020-08-14T09:42:57.371+00:00&quot;</span>,<span class="string">&quot;status&quot;</span>:404,<span class="string">&quot;error&quot;</span>:<span class="string">&quot;Not Found&quot;</span>,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;path&quot;</span>:<span class="string">&quot;/&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 本地访问2</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ idea]<span class="comment"># [root@iZ2zeg4ytp0whqtmxbsqiiZ idea]# curl localhost:32779/hello</span></span><br><span class="line">hello, xiaofan</span><br><span class="line"><span class="comment"># 远程访问（开启阿里云上的安全组哦）</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/17/Docker/20200814175211444.png" alt="在这里插入图片描述"></p>
<p>以后我们使用了 Docker 之后，给别人交付的就是一个镜像！</p>
</li>
</ol>
<h1 id="九、Docker-Compose"><a href="#九、Docker-Compose" class="headerlink" title="九、Docker Compose"></a>九、Docker Compose</h1><h2 id="1-Docker-Compose"><a href="#1-Docker-Compose" class="headerlink" title="1.Docker Compose"></a>1.Docker Compose</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Docker</p>
<p>Dockerfile build run 手动操作，单个容器！</p>
<p>微服务，100个微服务，依赖关系。</p>
<p>Dcoker Compose 来轻松高效的管理容器，定义运行多个容器。</p>
<blockquote>
<p>官方介绍</p>
</blockquote>
<ol>
<li>定义运行多个容器</li>
<li>YAML file 配置文件</li>
<li>single command。命令</li>
</ol>
<p>Compose is a tool for defining and running multi-container Docker applications. With Compose, you use a YAML file to configure your application’s services. Then, with a single command, you create and start all the services from your configuration. To learn more about all the features of Compose, see <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/#features">the list of features</a>.</p>
<ol start="4">
<li>所有的环境都可以使用 compose。</li>
</ol>
<p>Compose works in all environments: production, staging, development, testing, as well as CI workflows. You can learn more about each case in <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/#common-use-cases">Common Use Cases</a>.</p>
<p><strong>三步骤</strong></p>
<p>Using Compose is basically a three-step process:</p>
<ol>
<li>Define your app’s environment with a Dockerfile so it can be reproduced anywhere.<ul>
<li>Dockerfile保证我们的项目再任何地方可以运行</li>
</ul>
</li>
<li>Define the services that make up your app in docker-compose.yml so they can be run together in an isolated environment.<ul>
<li>services 什么是服务。</li>
</ul>
</li>
<li>Run docker-compose up and Compose starts and runs your entire app.<ul>
<li>启动项目</li>
</ul>
</li>
</ol>
<p><strong>作用：批量容器编排</strong></p>
<blockquote>
<p>我自己的理解</p>
</blockquote>
<p>Compose 是 Docker 官方的开源项目，需要安装！</p>
<p>Dockerfile 让程序在任何地方运行，web服务、redis、mysql、nginx…多个容器。run</p>
<p>Compose</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;2.0&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">    - <span class="string">&quot;5000:5000&quot;</span></span><br><span class="line">    volumes:</span><br><span class="line">    - .:/code</span><br><span class="line">    - logvolume01:/var/log</span><br><span class="line">    links:</span><br><span class="line">    - redis</span><br><span class="line">  redis:</span><br><span class="line">    image: redis</span><br><span class="line">volumes:</span><br><span class="line">  logvolume01: &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>docker-copose up 100个服务</p>
<p>Comspose：重要概念</p>
<ul>
<li>服务 services，容器、应用（web、redis、mysql…）</li>
<li>项目 project。一组关联的容器</li>
</ul>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ol>
<li>下载</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 官网提供 （没有下载成功）</span></span><br><span class="line">curl -L <span class="string">&quot;https://github.com/docker/compose/releases/download/1.26.2/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 国内地址</span></span><br><span class="line">curl -L https://get.daocloud.io/docker/compose/releases/download/1.25.5/docker-compose-`<span class="built_in">uname</span> -s`-`<span class="built_in">uname</span> -m` &gt; /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>授权</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665974648638224.png" alt="在这里插入图片描述"></p>
<p><strong>体验（没有测试通过）</strong></p>
<p>地址：<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/gettingstarted/">https://docs.docker.com/compose/gettingstarted/</a><br>python 应用。计数器。redis！</p>
<ol>
<li><p>应用app.py</p>
</li>
<li><p>Dockerfile 应用打包为镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM python:3.6-alpine</span><br><span class="line">ADD . /code</span><br><span class="line">WORKDIR /code</span><br><span class="line">RUN pip install -r requirements.txt</span><br><span class="line">CMD [<span class="string">&quot;python&quot;</span>, <span class="string">&quot;app.py&quot;</span>]</span><br><span class="line"><span class="comment"># 官网的用来flask框架，我们这里不用它</span></span><br><span class="line"><span class="comment"># 这告诉Docker</span></span><br><span class="line"><span class="comment"># 从python3.7开始构建镜像</span></span><br><span class="line"><span class="comment"># 将当前目录添加到/code印像中的路径中</span></span><br><span class="line"><span class="comment"># 将工作目录设置为/code</span></span><br><span class="line"><span class="comment"># 安装Python依赖项</span></span><br><span class="line"><span class="comment"># 将容器的默认命令设置为python app.py</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Dockerfile-compose.yaml 文件（定义整个服务，需要的环境 web、redis）完整的上线服务！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;5000:5000&quot;</span></span><br><span class="line">    volumes:</span><br><span class="line">      - .:/code</span><br><span class="line">  redis:</span><br><span class="line">    image: <span class="string">&quot;redis:alpine&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>启动 compose 项目 （docker-compose up -d）</p>
<p>流程：</p>
<ol>
<li>创建网络</li>
<li>执行 Docker-compose.yaml</li>
<li>启动服务</li>
</ol>
</li>
</ol>
<h3 id="yaml-规则"><a href="#yaml-规则" class="headerlink" title="yaml 规则"></a>yaml 规则</h3><p>docker-compose.yaml 核心！</p>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#compose-file-structure-and-examples">https://docs.docker.com/compose/compose-file/#compose-file-structure-and-examples</a></p>
<h3 id="开源项目：博客"><a href="#开源项目：博客" class="headerlink" title="开源项目：博客"></a>开源项目：博客</h3><p><a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#compose-file-structure-and-examples">https://docs.docker.com/compose/compose-file/#compose-file-structure-and-examples</a></p>
<p>下载程序、安装数据库、配置……</p>
<p>compose 应用 &#x3D;&gt; 一键启动</p>
<ol>
<li>下载项目（docker-compose.yaml）</li>
<li>如果需要文件。Dockerfile</li>
<li>文件准备齐全，一键启动项目即可</li>
</ol>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665975026264227.png" alt="在这里插入图片描述"></p>
<h3 id="实战：自己编写微服务上线"><a href="#实战：自己编写微服务上线" class="headerlink" title="实战：自己编写微服务上线"></a>实战：自己编写微服务上线</h3><ol>
<li><p>编写项目微服务</p>
</li>
<li><p>Dockerfile 构建镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM java:8</span><br><span class="line">COPY *.jar /app.jar</span><br><span class="line">CMD [<span class="string">&quot;--server.port=8080&quot;</span>]</span><br><span class="line">EXPOSE 8080</span><br><span class="line">ENTRYPOINT [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;/app.jar&quot;</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>docker-compose.yml 编排项目</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">version <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  xiaofanapp:</span><br><span class="line">    build: .</span><br><span class="line">    image: xiaofanapp</span><br><span class="line">    depends_on:</span><br><span class="line">      - redis</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line"> </span><br><span class="line">  redis:</span><br><span class="line">    image: <span class="string">&quot;library/redis:alpine&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>丢到服务器运行 docker-compose up -d</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose down         # 关闭容器并删除容器</span><br><span class="line">docker-compose up --build   # 重新构建</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665975167852230.png" alt="在这里插入图片描述"></p>
</li>
</ol>
<p><img src="/2022/10/17/Docker/20200815163905484.png" alt="在这里插入图片描述"></p>
<p><strong>总结：</strong></p>
<p><strong>工程、服务、容器</strong></p>
<p>项目 compose： 三层</p>
<ul>
<li>工程 project</li>
<li>服务</li>
<li>容器 运行实例！ docker k8s 容器</li>
</ul>
<h1 id="十、Docker-Swarm"><a href="#十、Docker-Swarm" class="headerlink" title="十、Docker Swarm"></a>十、Docker Swarm</h1><h2 id="1-Docekr-Swarm"><a href="#1-Docekr-Swarm" class="headerlink" title="1.Docekr Swarm"></a>1.Docekr Swarm</h2><p>集群</p>
<h3 id="购买服务器"><a href="#购买服务器" class="headerlink" title="购买服务器"></a>购买服务器</h3><ol>
<li><p>登录阿里云账号，进入控制台，创建实例</p>
<p>4台服务器2G</p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665975627725235.png" alt="在这里插入图片描述"></p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665975654115241.png" alt="加粗样式"></p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665975676643244.png" alt="在这里插入图片描述"></p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665975687587247.png" alt="在这里插入图片描述"></p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665975699744250.png" alt="在这里插入图片描述"></p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665975709205253.png" alt="在这里插入图片描述"></p>
<p>到此，我们服务器购买成功！</p>
</li>
</ol>
<p><strong>四台机器安装 docker</strong></p>
<p>和我们单机安装一样</p>
<p>技巧：xshell 直接同步操作，省时间！</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/fanjianhai/article/details/107860159">Docker的安装</a></li>
</ul>
<h3 id="Swarm-集群搭建"><a href="#Swarm-集群搭建" class="headerlink" title="Swarm 集群搭建"></a>Swarm 集群搭建</h3><ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/swarm/how-swarm-mode-works/nodes/">工作机制</a></li>
</ul>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665975855383259.png" alt="在这里插入图片描述"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker swarm init --<span class="built_in">help</span></span><br><span class="line"> </span><br><span class="line">ip addr <span class="comment"># 获取自己的ip（用内网的不要流量）</span></span><br><span class="line"> </span><br><span class="line">[root@iZ2ze58v8acnlxsnjoulk5Z ~]<span class="comment"># docker swarm init --advertise-addr 172.16.250.97</span></span><br><span class="line">Swarm initialized: current node (otdyxbk2ffbogdqq1kigysj1d) is now a manager.</span><br><span class="line">To add a worker to this swarm, run the following <span class="built_in">command</span>:</span><br><span class="line">    docker swarm <span class="built_in">join</span> --token SWMTKN-1-3vovnwb5pkkno2i3u2a42yrxc1dk51zxvto5hrm4asgn37syfn-0xkrprkuyyhrx7cidg381pdir 172.16.250.97:2377</span><br><span class="line">To add a manager to this swarm, run <span class="string">&#x27;docker swarm join-token manager&#x27;</span> and follow the instructions.</span><br></pre></td></tr></table></figure>

<p>初始化结点docker swarm init</p>
<p>docker swarm join 加入一个结点！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取令牌</span></span><br><span class="line">docker swarm join-token manager</span><br><span class="line">docker swarm join-token worker</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2ze58v8acnlxsnjoulk6Z ~]<span class="comment"># docker swarm join --token SWMTKN-1-3vovnwb5pkkno2i3u2a42yrxc1dk51zxvto5hrm4asgn37syfn-0xkrprkuyyhrx7cidg381pdir 172.16.250.97:2377</span></span><br><span class="line">This node joined a swarm as a worker.</span><br></pre></td></tr></table></figure>

<p>把后面的结点都搭建进去</p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665975976134262.png" alt="在这里插入图片描述"></p>
<ol>
<li>生成主节点 init</li>
<li>加入 （管理者，worker）</li>
</ol>
<h3 id="Raft-协议"><a href="#Raft-协议" class="headerlink" title="Raft 协议"></a>Raft 协议</h3><p>双主双从：假设一个结点挂了！其他结点是否可以用！</p>
<p>Raft 协议：保证大多数结点存活才可以使用，只要 &gt; 1，集群至少大于3台！</p>
<p>实验：</p>
<p>1、将 docker1 机器停止。宕机！双主，另一个结点也不能使用了！</p>
<p><img src="/2022/10/17/Docker/20200817102811431.png" alt="在这里插入图片描述"></p>
<p>2、可以将其他结点离开 docker swarm leave</p>
<p><img src="/2022/10/17/Docker/202008171034151.png" alt="在这里插入图片描述"></p>
<p>3、worker 就是工作的，管理结点操作！3台结点设置为了管理结点。</p>
<p>4、<a target="_blank" rel="noopener" href="https://www.cnblogs.com/zoujiaojiao/p/10886262.html">Docker swarm集群增加节点</a></p>
<p>十分简单：集群，可用！3个主节点。 &gt; 1台管理结点存活！</p>
<p>Raft 协议：保证大多数结点存活，才可以使用，高可用</p>
<p><strong>体会</strong></p>
<p>弹性、扩缩容！集群！</p>
<p>以后告别 docker run！</p>
<p>docker-compose up！ 启动一个项目。单机！</p>
<p>集群：swarm docker-service</p>
<p>k8s service</p>
<p>容器 &#x3D;&gt; 服务！</p>
<p>容器 &#x3D;&gt; 服务！ &#x3D;&gt; 副本！</p>
<p>redis &#x3D;&gt; 10个副本！（同时开启10个redis容器）</p>
<p>体验：创建服务、动态扩容服务、动态更新服务</p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665976552585269.png" alt="在这里插入图片描述"></p>
<ul>
<li>灰度发布</li>
</ul>
<p><img src="/2022/10/17/Docker/20200817124458860.png" alt="在这里插入图片描述"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run 容器启动！ 不具有扩缩容器</span><br><span class="line">docker service 服务！ 具有扩缩容器，滚动更新！</span><br></pre></td></tr></table></figure>

<p>查看服务</p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665976607970274.png" alt="在这里插入图片描述"></p>
<p>动态扩缩容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2ze58v8acnlxsnjoulk5Z ~]<span class="comment"># docker service update --replicas 3 my-nginx</span></span><br><span class="line">1/3: running   [==================================================&gt;] </span><br><span class="line">1/3: running   [==================================================&gt;] </span><br><span class="line">2/3: running   [==================================================&gt;] </span><br><span class="line">3/3: running   [==================================================&gt;] </span><br><span class="line">verify: Service converged </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[root@iZ2ze58v8acnlxsnjoulk5Z ~]<span class="comment"># docker service scale my-nginx=5</span></span><br><span class="line">my-nginx scaled to 5</span><br><span class="line">overall progress: 3 out of 5 tasks </span><br><span class="line">overall progress: 3 out of 5 tasks </span><br><span class="line">overall progress: 3 out of 5 tasks </span><br><span class="line">overall progress: 5 out of 5 tasks </span><br><span class="line">1/5: running   [==================================================&gt;] </span><br><span class="line">2/5: running   [==================================================&gt;] </span><br><span class="line">3/5: running   [==================================================&gt;] </span><br><span class="line">4/5: running   [==================================================&gt;] </span><br><span class="line">5/5: running   [==================================================&gt;] </span><br><span class="line">verify: Service converged </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[root@iZ2ze58v8acnlxsnjoulk5Z ~]<span class="comment"># docker service scale my-nginx=1</span></span><br><span class="line">my-nginx scaled to 1</span><br><span class="line">overall progress: 1 out of 1 tasks </span><br><span class="line">1/1: running   [==================================================&gt;] </span><br><span class="line">verify: Service converged </span><br></pre></td></tr></table></figure>

<p>移出！ docker service rm</p>
<p>docker swarm 其实并不难</p>
<p>只要会搭建集群、会启动服务、动态管理容器就可以！</p>
<h3 id="概念总结"><a href="#概念总结" class="headerlink" title="概念总结"></a>概念总结</h3><p><strong>swarm</strong></p>
<p>集群的管理和编号，docker 可以初始化一个 swarm 集群，其他结点可以加入。（管理，工作者）</p>
<p><strong>Node</strong></p>
<p>就是一个 docker 结点，多个结点就组成了一个网络集群（管理、工作者）</p>
<p><strong>Service</strong></p>
<p>任务、可以在管理结点或者工作结点来运行。核心、用户访问。</p>
<p><strong>Task</strong></p>
<p>容器内的命令、细节任务！</p>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665977290237277.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>sevice</p>
</blockquote>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665977319600280.png" alt="在这里插入图片描述"></p>
<p>命令 -&gt; 管理 -&gt; api -&gt; 调度 -&gt; 工作结点（创建Task容器维护创建！）</p>
<blockquote>
<p>服务副本和全局服务</p>
</blockquote>
<p><img src="/2022/10/17/Docker/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center-1665977414076283.png" alt="在这里插入图片描述"></p>
<p>调整 service 以什么方式运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--mode string                        </span><br><span class="line">Service mode (replicated or global) (default <span class="string">&quot;replicated&quot;</span>)</span><br><span class="line"> </span><br><span class="line">docker service create --mode replicated --name mytom tomcat:7 默认的</span><br><span class="line">docker service create --mode global  --name haha alpine ping www.baidu.com</span><br></pre></td></tr></table></figure>

<p>拓展：网络模式“PublishModel”：“ingress”</p>
<p>Swarm：</p>
<p>Overlay：</p>
<p>ingress：特殊的Overlay网络！负载均衡功能！ ipvs vip！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2ze58v8acnlxsnjoulk5Z ~]<span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">74cecd37149f        bridge              bridge              <span class="built_in">local</span></span><br><span class="line">168d35c86dd5        docker_gwbridge     bridge              <span class="built_in">local</span></span><br><span class="line">2b8f4eb9c2e5        host                host                <span class="built_in">local</span></span><br><span class="line">dmddfc14n7r3        ingress             overlay             swarm</span><br><span class="line">8e0f5f648e69        none                null                <span class="built_in">local</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[root@iZ2ze58v8acnlxsnjoulk5Z ~]<span class="comment"># docker network inspect ingress</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;ingress&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;dmddfc14n7r3vms5vgw0k5eay&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2020-08-17T10:29:07.002315919+08:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;swarm&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;overlay&quot;</span>,</span><br><span class="line">        <span class="string">&quot;EnableIPv6&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;IPAM&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Options&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Config&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;Subnet&quot;</span>: <span class="string">&quot;10.0.0.0/24&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;10.0.0.1&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Internal&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Attachable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Ingress&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;ConfigFrom&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;ConfigOnly&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Containers&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;ingress-sbox&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;ingress-endpoint&quot;</span>,</span><br><span class="line">                <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;9d6ec47ec8309eb209f4ff714fbe728abe9d88f9f1cc7e96e9da5ebd95adb1c4&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:0a:00:00:02&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;10.0.0.2/24&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;com.docker.network.driver.overlay.vxlanid_list&quot;</span>: <span class="string">&quot;4096&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Peers&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;cea454a89163&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IP&quot;</span>: <span class="string">&quot;172.16.250.96&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;899a05b64e09&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IP&quot;</span>: <span class="string">&quot;172.16.250.99&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;81d65a0e8c03&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IP&quot;</span>: <span class="string">&quot;172.16.250.97&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;36b31096f7e2&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IP&quot;</span>: <span class="string">&quot;172.16.250.98&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="其他命令学习方式"><a href="#其他命令学习方式" class="headerlink" title="其他命令学习方式"></a>其他命令学习方式</h3><ul>
<li>Docker Stack</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker-compose 单机部署项目</span><br><span class="line">docker stack 集群部署</span><br><span class="line"><span class="comment"># 单机</span></span><br><span class="line">docker-compose up -d wordpress.yaml</span><br><span class="line"><span class="comment"># 集群</span></span><br><span class="line">docker stack deploy wordpress.yaml</span><br></pre></td></tr></table></figure>

<ul>
<li>Docker Secret</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安全！配置密码！证书！</span></span><br><span class="line"> </span><br><span class="line">[root@iZ2ze58v8acnlxsnjoulk5Z ~]<span class="comment"># docker secret --help</span></span><br><span class="line"> </span><br><span class="line">Usage:  docker secret COMMAND</span><br><span class="line"> </span><br><span class="line">Manage Docker secrets</span><br><span class="line"> </span><br><span class="line">Commands:</span><br><span class="line">  create      Create a secret from a file or STDIN as content</span><br><span class="line">  inspect     Display detailed information on one or more secrets</span><br><span class="line">  <span class="built_in">ls</span>          List secrets</span><br><span class="line">  <span class="built_in">rm</span>          Remove one or more secrets</span><br></pre></td></tr></table></figure>

<ul>
<li>Docker config</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置！</span></span><br><span class="line">[root@iZ2ze58v8acnlxsnjoulk5Z ~]<span class="comment"># docker config --help</span></span><br><span class="line"> </span><br><span class="line">Usage:  docker config COMMAND</span><br><span class="line"> </span><br><span class="line">Manage Docker configs</span><br><span class="line"> </span><br><span class="line">Commands:</span><br><span class="line">  create      Create a config from a file or STDIN</span><br><span class="line">  inspect     Display detailed information on one or more configs</span><br><span class="line">  <span class="built_in">ls</span>          List configs</span><br><span class="line">  <span class="built_in">rm</span>          Remove one or more configs</span><br></pre></td></tr></table></figure>

<h3 id="拓展到k8s"><a href="#拓展到k8s" class="headerlink" title="拓展到k8s"></a>拓展到k8s</h3><p><strong>云原生时代</strong></p>
<p>Go语言！必须掌握！ java Go！</p>
<p>并发语言！</p>
<p>B语言，C语言的创始人。Unix创始人 VB</p>
<p>go指针</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8088:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=<span class="literal">true</span> portainer/portainer</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">[root@iZ2zeg4ytp0whqtmxbsqiiZ home]<span class="comment"># curl localhost:8088</span></span><br><span class="line">&lt;!DOCTYPE html</span><br><span class="line">&gt;&lt;html lang=<span class="string">&quot;en&quot;</span> ng-app=<span class="string">&quot;portainer&quot;</span>&gt;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 外网访问 http://ip:8088</span></span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="http://example.com">柚屿</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2022/10/17/Docker/">http://example.com/2022/10/17/Docker/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/06/22/MybatisTwoDay/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">mybatis笔记2</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">柚屿</div><div class="author-info__description">pomeloisland从入门到放弃</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">14</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/pomeloisland"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker%E7%B2%BE%E9%80%89"><span class="toc-number">1.</span> <span class="toc-text">Docker精选</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81Docker%E5%85%A5%E9%97%A8"><span class="toc-number">2.</span> <span class="toc-text">一、Docker入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Docker%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%87%BA%E7%8E%B0"><span class="toc-number">2.1.</span> <span class="toc-text">1.Docker为什么会出现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Docker%E7%9A%84%E5%8E%86%E5%8F%B2"><span class="toc-number">2.2.</span> <span class="toc-text">2.Docker的历史</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Docker%E7%9A%84%E5%AD%A6%E4%B9%A0"><span class="toc-number">2.3.</span> <span class="toc-text">3.Docker的学习</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF%E5%92%8C%E5%AE%B9%E5%99%A8%E5%8C%96%E6%8A%80%E6%9C%AF%E5%AF%B9%E6%AF%94"><span class="toc-number">2.4.</span> <span class="toc-text">4.虚拟化技术和容器化技术对比</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF%E7%9A%84%E7%BC%BA%E7%82%B9"><span class="toc-number">2.4.1.</span> <span class="toc-text">4.1.虚拟化技术的缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2%E5%AE%B9%E5%99%A8%E5%8C%96%E6%8A%80%E6%9C%AF"><span class="toc-number">2.4.2.</span> <span class="toc-text">4.2容器化技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3DevOps"><span class="toc-number">2.4.3.</span> <span class="toc-text">4.3DevOps</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="toc-number">2.5.</span> <span class="toc-text">5.名词解释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">2.6.</span> <span class="toc-text">6.环境准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%AE%89%E8%A3%85Docker"><span class="toc-number">2.7.</span> <span class="toc-text">7.安装Docker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="toc-number">2.8.</span> <span class="toc-text">8.底层原理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Docker-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-number">3.</span> <span class="toc-text">二、Docker 基本命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Docker-%E7%9A%84%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.0.1.</span> <span class="toc-text">1.Docker 的常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">3.0.1.1.</span> <span class="toc-text">镜像命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.0.1.2.</span> <span class="toc-text">容器命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="toc-number">3.0.1.3.</span> <span class="toc-text">常用的其他命令</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81Docker%E9%83%A8%E7%BD%B2%E8%BD%AF%E4%BB%B6%E5%AE%9E%E6%88%98"><span class="toc-number">4.</span> <span class="toc-text">三、Docker部署软件实战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Docker%E9%83%A8%E7%BD%B2%E8%BD%AF%E4%BB%B6%E5%AE%9E%E6%88%98"><span class="toc-number">4.1.</span> <span class="toc-text">1.Docker部署软件实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker%E5%AE%89%E8%A3%85Nginx"><span class="toc-number">4.1.0.1.</span> <span class="toc-text">Docker安装Nginx</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Docker%E5%AE%89%E8%A3%85Tomcat"><span class="toc-number">4.2.</span> <span class="toc-text">2.Docker安装Tomcat</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%99%E6%A0%B7-docker-%E9%83%A8%E7%BD%B2-tomcat-%E5%B0%B1%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE%E4%BA%86"><span class="toc-number">4.2.0.1.</span> <span class="toc-text">这样 docker 部署 tomcat 就可以访问了</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Docker-%E9%83%A8%E7%BD%B2-elasticsearch-kibana"><span class="toc-number">4.3.</span> <span class="toc-text">3.Docker 部署 elasticsearch + kibana</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A%E4%B8%89%EF%BC%9A%E4%BD%BF%E7%94%A8-kibana-%E8%BF%9E%E6%8E%A5-es-%EF%BC%88elasticSearch%EF%BC%89%EF%BC%9F%E6%80%9D%E8%80%83%E7%BD%91%E8%B7%AF%E5%A6%82%E4%BD%95%E6%89%8D%E8%83%BD%E8%BF%9E%E6%8E%A5"><span class="toc-number">4.3.0.1.</span> <span class="toc-text">作业三：使用 kibana 连接 es （elasticSearch）？思考网路如何才能连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Portainer-%E5%8F%AF%E8%A7%86%E5%8C%96%E9%9D%A2%E6%9D%BF%E5%AE%89%E8%A3%85"><span class="toc-number">4.3.0.2.</span> <span class="toc-text">Portainer 可视化面板安装</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Docker-%E5%8E%9F%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">四、Docker 原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%8E%9F%E7%90%86%E4%B9%8B%E8%81%94%E5%90%88%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">5.1.</span> <span class="toc-text">镜像原理之联合文件系统</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">6.</span> <span class="toc-text">五、容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">6.1.</span> <span class="toc-text">1.容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-docker-%E7%9A%84%E7%90%86%E8%A7%A3%E5%9B%9E%E9%A1%BE"><span class="toc-number">6.1.1.</span> <span class="toc-text">1.1.docker 的理解回顾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">6.1.2.</span> <span class="toc-text">1.2.使用数据卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E5%AE%9E%E6%88%98%EF%BC%9A%E5%AE%89%E8%A3%85-MySQL"><span class="toc-number">6.1.3.</span> <span class="toc-text">1.3.实战：安装 MySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E5%8C%BF%E5%90%8D%E5%92%8C%E5%85%B7%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="toc-number">6.1.4.</span> <span class="toc-text">1.4.匿名和具名挂载</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81Dockerfile"><span class="toc-number">7.</span> <span class="toc-text">六、Dockerfile</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B-Dockerfile"><span class="toc-number">7.1.</span> <span class="toc-text">初始 Dockerfile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="toc-number">7.2.</span> <span class="toc-text">数据卷容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dockerfile"><span class="toc-number">7.3.</span> <span class="toc-text">Dockerfile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DockerFile-%E7%9A%84%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-number">7.4.</span> <span class="toc-text">DockerFile 的构建过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DockerFile-%E6%8C%87%E4%BB%A4%E8%AF%B4%E6%98%8E"><span class="toc-number">7.5.</span> <span class="toc-text">DockerFile 指令说明</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81DockerFile-%E5%88%B6%E4%BD%9C-tomcat-%E9%95%9C%E5%83%8F"><span class="toc-number">8.</span> <span class="toc-text">七、DockerFile 制作 tomcat 镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DockerFile-%E5%88%B6%E4%BD%9C-tomcat-%E9%95%9C%E5%83%8F"><span class="toc-number">8.1.</span> <span class="toc-text">DockerFile 制作 tomcat 镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84%E9%95%9C%E5%83%8F%E5%88%B0-Docker-Hub"><span class="toc-number">8.2.</span> <span class="toc-text">发布自己的镜像到 Docker Hub</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E9%95%9C%E5%83%8F%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1%E4%B8%8A"><span class="toc-number">8.3.</span> <span class="toc-text">发布镜像到阿里云镜像服务上</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">8.4.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%E3%80%81Docker-%E7%BD%91%E7%BB%9C"><span class="toc-number">9.</span> <span class="toc-text">八、Docker 网络</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Docker-%E7%BD%91%E7%BB%9C"><span class="toc-number">9.1.</span> <span class="toc-text">1.Docker 网络</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5-Docker0"><span class="toc-number">9.1.1.</span> <span class="toc-text">链接 Docker0</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C"><span class="toc-number">9.2.</span> <span class="toc-text">2.自定义网络</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%BD%91%E7%BB%9C%E8%BF%9E%E9%80%9A"><span class="toc-number">9.3.</span> <span class="toc-text">3.网络连通</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%B5%8B%E8%AF%95%E6%89%93%E9%80%9A-tomcat01-%E5%92%8C-mynet"><span class="toc-number">9.4.</span> <span class="toc-text">4.测试打通 tomcat01 和 mynet</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%AE%9E%E6%88%98%EF%BC%9A%E9%83%A8%E7%BD%B2-redis"><span class="toc-number">9.5.</span> <span class="toc-text">5.实战：部署 redis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-SpringBoot-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%89%93%E5%8C%85-Docker-%E9%95%9C%E5%83%8F"><span class="toc-number">9.6.</span> <span class="toc-text">6.SpringBoot 微服务打包 Docker 镜像</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%9D%E3%80%81Docker-Compose"><span class="toc-number">10.</span> <span class="toc-text">九、Docker Compose</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Docker-Compose"><span class="toc-number">10.1.</span> <span class="toc-text">1.Docker Compose</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">10.1.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">10.1.2.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#yaml-%E8%A7%84%E5%88%99"><span class="toc-number">10.1.3.</span> <span class="toc-text">yaml 规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%EF%BC%9A%E5%8D%9A%E5%AE%A2"><span class="toc-number">10.1.4.</span> <span class="toc-text">开源项目：博客</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%EF%BC%9A%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%8A%E7%BA%BF"><span class="toc-number">10.1.5.</span> <span class="toc-text">实战：自己编写微服务上线</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E3%80%81Docker-Swarm"><span class="toc-number">11.</span> <span class="toc-text">十、Docker Swarm</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Docekr-Swarm"><span class="toc-number">11.1.</span> <span class="toc-text">1.Docekr Swarm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%AD%E4%B9%B0%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">11.1.1.</span> <span class="toc-text">购买服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Swarm-%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA"><span class="toc-number">11.1.2.</span> <span class="toc-text">Swarm 集群搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Raft-%E5%8D%8F%E8%AE%AE"><span class="toc-number">11.1.3.</span> <span class="toc-text">Raft 协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5%E6%80%BB%E7%BB%93"><span class="toc-number">11.1.4.</span> <span class="toc-text">概念总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4%E5%AD%A6%E4%B9%A0%E6%96%B9%E5%BC%8F"><span class="toc-number">11.1.5.</span> <span class="toc-text">其他命令学习方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%E5%88%B0k8s"><span class="toc-number">11.1.6.</span> <span class="toc-text">拓展到k8s</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/10/17/Docker/" title="Docker精选"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker精选"/></a><div class="content"><a class="title" href="/2022/10/17/Docker/" title="Docker精选">Docker精选</a><time datetime="2022-10-17T01:10:34.794Z" title="Created 2022-10-17 09:10:34">2022-10-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/22/MybatisTwoDay/" title="mybatis笔记2"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="mybatis笔记2"/></a><div class="content"><a class="title" href="/2022/06/22/MybatisTwoDay/" title="mybatis笔记2">mybatis笔记2</a><time datetime="2022-06-22T03:23:58.704Z" title="Created 2022-06-22 11:23:58">2022-06-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/22/notes/" title="java笔记"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="java笔记"/></a><div class="content"><a class="title" href="/2022/06/22/notes/" title="java笔记">java笔记</a><time datetime="2022-06-22T03:23:58.704Z" title="Created 2022-06-22 11:23:58">2022-06-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/22/notes1/" title="java笔记"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="java笔记"/></a><div class="content"><a class="title" href="/2022/06/22/notes1/" title="java笔记">java笔记</a><time datetime="2022-06-22T03:23:58.704Z" title="Created 2022-06-22 11:23:58">2022-06-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/22/printCalender/" title="java程序"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="java程序"/></a><div class="content"><a class="title" href="/2022/06/22/printCalender/" title="java程序">java程序</a><time datetime="2022-06-22T03:23:58.704Z" title="Created 2022-06-22 11:23:58">2022-06-22</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 柚屿</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@4.2.2/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@4.2.2/source/js/main.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>